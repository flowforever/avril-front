/*! avril-front - v0.0.4 - 2014-08-14 */
!function(a){return a.avril&&avril.avril?avril:(function(){var b=(a.avril,{});b.avril="avril",b.$=jQuery;var c=function(a){("function"==typeof a||"object"==typeof a)&&(a.extend=function(d,e){if(d)if(e)"string"==typeof d&&(a[d]=e);else if("function"==typeof d||"object"==typeof d){for(var f in d)a[f]=d[f],c(a[f]);d.ready&&"function"==typeof d.ready&&b.ready(function(){d.ready.call(d)})}})};b.isValueType=function(a){return null==a||"number,boolean,string,undefined".split(",").indexOf(typeof a)>=0},b.isFunc=function(a){return"function"==typeof a},b.isObj=function(a){return"object"==typeof a},b.isArray=function(a){return a instanceof Array},b.isStr=function(a){return"string"==typeof a},b.helper={encode:function(a){return $("<div/>").html(a).text()},decode:function(a){return $("<div/>").text(a).html()},encodeReg:function(a){var b="~!@#$%^&*()/\\|[].".split("");return a.split("").select(function(a){return b.indexOf(a)>=0?"\\"+a:a}).join("")}},b.namespace=function(b,d){function e(a,b){if(a.indexOf(".")>0){var d=a.substring(0,a.indexOf("."));return b[d]||(b[d]=new Object,c(b[d])),e(a.substring(a.indexOf(".")+1),b[d])}return b[a]?void 0:(b[a]=new Object,c(b[a]),b[a])}if(b&&"string"==typeof b)return e(b,d||a);throw" typeof(spaceName) must be string!"},b.module=function(c,d,e){2==arguments.length&&(e=d,d=[]),"string"==typeof d&&(d=d.trimAll().split(","));var f=b.module.getModuleEvent,g=d.where(function(c){return!b.object(a).getVal(c)}),h=0,i=function(h){if(j(),h==g.length){b.namespace(c);var i=b.object(a).getVal(c),k=d.select(function(c){return b.object(a).getVal(c)});e.apply(i,k),f(c)([name])}},j=function(){var e=g.where(function(c){return!b.object(a).getVal(c)}),f=d.where(function(c){return!!b.object(a).getVal(c)});console.log(0==e.length?c+" dependences loaded complete.":c+" dependences loaded "+f.join(",")+", waiting: "+e.join(","))};g.length>0&&g.each(function(a){f(a)(function(){i(++h)})}),i(0)},b.module.getModuleEvent=function(a){return b.event.get("module.events."+a)},b.module.notify=function(a,c){b.module.getModuleEvent(a)([a,c])},b.module.subscribe=function(a,c){b.module.getModuleEvent(a)(c)},b.extend=function(a,d){var a=arguments[0],d=arguments[1];if(a)if(d){if("string"==typeof a)b[a]=d,c(b[a]);else if("object"==typeof a||"function"==typeof a)for(var e in d)a[e]=d[e]}else if("object"==typeof a||"function"==typeof a)for(var e in a)b[e]=a[e],c(b[e]);return b};var d={maxDeep:5,isValueType:function(a){return null==a||"number,boolean,string,undefined".split(",").indexOf(typeof a)>=0},getVal:function(a,b){if(b.indexOf(".")>0){var c=b.substring(0,b.indexOf(".")),d=b.substring(b.indexOf(".")+1);if(!(c.indexOf("[")>=0)){var e=a[c];return this.getVal(e,d)}var f=c.substring(c.indexOf("[")+1,c.lastIndexOf("]"));if(f=parseInt(f),0==c.indexOf("["))return this.getVal(a[f],d);if(c.indexOf("[")>0){var g=b.substring(0,b.indexOf("["));return 0==g.indexOf('"')&&(g=g.substring(1,g.length-2)),this.getVal(a[g][f],d)}}else{if(!(b.indexOf("[")>=0))return a[b];var f=b.substring(b.indexOf("[")+1,b.lastIndexOf("]"));if(f=parseInt(f),0==b.indexOf("["))return a[f];if(b.indexOf("[")>0){var g=b.substring(0,b.indexOf("["));return a[g][f]}}},setVal:function(a,b,c){if(b.indexOf(".")>0){var d=b.substring(0,b.indexOf(".")),e=b.substring(b.indexOf(".")+1);if(d.indexOf("[")>=0){var f=d.substring(d.indexOf("[")+1,d.indexOf("]"));if(f=parseInt(f),0==d.indexOf("["))a[f]||(a[f]={}),this.setVal(a[f],e,c);else if(d.indexOf("[")>0){var g=b.substring(0,b.indexOf("["));a[g]||(a[g]=[]),a[g][f]||(a[g][f]={}),this.setVal(a[g][f],e,c)}}else a[d]||(a[d]={}),this.setVal(a[d],e,c)}else{var h=/\[\d*\]/;if(h.test(b)){var f=b.substring(b.indexOf("[")+1,b.lastIndexOf("]"));if(f=parseInt(f),0==b.indexOf("["))a[f]=c;else if(b.indexOf("[")>0){var g=b.substring(0,b.indexOf("["));a[g]||(a[g]=[]),a[g][f]=c}}else a[b]=c}return a},beautifyNames:function(a,c,d){var e=this;if(b.isArray(a)){for(var f=[],g=0;g<a.length;g++){var h=a[g];(b.isObj(h)||b.isArray(h))&&(h=e.beautifyNames(h,c+1,d)),f.push(h)}return f}if(b.isObj(a)){var i={};return c=void 0==c||isNaN(c)?0:c,c>this.maxDeep?i:(void 0==d&&(d=!0),this.each(a,function(a,f){e.isValueType(f)?i[a]=f:b.isObj(f)?b.isStr(a)&&d?i[a.lowerChar0()]=b.object.beautifyNames(f,c+1,d):i[a]=b.object.beautifyNames(f,c+1,d):b.isStr(a)&&d?i[a.lowerChar0()]=f:i[a]=f}),i)}},deepClone:function(a,b){return this.beautifyNames(a,b,!1)},each:function(a,c){if(!b.isFunc(c))return!1;if(b.isArray(a)){for(var d=0;d<a.length;d++)if(0==c(d,a[d]))return!1}else for(var e in a)if(0==c(e,a[e]))return!1},keys:function(a){var b=[];return this.each(a,function(a){b.push(a)}),b},values:function(a){var b=[];return this.each(a,function(a,c){b.push(c)}),b},tryGetVal:function(a,b){var c=void 0;try{c=this.getVal(a,b)}catch(d){}return c},instanceOf:function(a,b){return a instanceof b},keyValues:function(a){var b=[];return this.each(a,function(a,c){b.push({key:a,value:c})}),b},toArray:function(a){var b=[];if(a.length)for(var c=0;c<a.length;c++)b.push(a[c]);return b}};b.object=function(a){var c={getVal:function(c){return b.object.getVal(a,c)},setVal:function(c,d){return b.object.setVal(a,c,d)},each:function(c){b.object.each(a,c)},keys:function(){return b.object.keys(a)},values:function(){return b.object.values(a)},beautifyNames:function(){return b.object.beautifyNames(a)},deepClone:function(c){return b.object.deepClone(a,c)},tryGetVal:function(c){var d=void 0;try{d=b.object.getVal(a,c)}catch(e){}return d},instanceOf:function(c){return b.object.instanceOf(a,c)},keyValues:function(){return b.object.keyValues(a)},toArray:function(){return b.object.toArray(a)}};return c},$.extend(b.object,d);var e={};b.data=function(a,c){if("string"!=typeof a&&(a=b.getHash(a).toLowerCase()),1==arguments.length){try{var d=b.object.getVal(e,a);return d}catch(f){}return null}if(2==arguments.length)b.object.setVal(e,a,c);else if(0==arguments.length)return e},b.guid=function(){return(new Date).getTime()+"_"+Math.random().toString().replace(".","_")},b.alert=function(a){alert(a)},b.confirm=function(a,b){b(void 0==a||""==a?!0:confirm(a))};var f=[],g=function(a){var c=f.first(function(b){return b.obj==a});return c||(c={obj:a,key:b.guid()},f.push(c)),c.key};b.getHash=g;var h=!1;b._single=function(){h||(b.getHash=top.avril?top.avril.getHash:g),h=!0},a.avril=b}(),function(b,c){function d(a,b){var b=b||g+"["+h+"].",c=b+a;return f._event[c]||f.register(c),f._event[c]}function e(a,b,e){var f=f||"before",g=g||"on",h=a,j=h[b],k=i(f,b),l=i(g,b);if("function"!=typeof h[b]||"function"==typeof h[b][k]||"function"==typeof h[b][l])return h;var m=d(k,e),n=d(l,e);h[b]=function(){var a=this;if(m(a,arguments)){var b=j.apply(a,arguments),c=[];c.push(b);for(var d=0;d<arguments.length;d++)c.push(arguments[d]);return n(a,c),b}return!1},h[b]._orgFunc=j,h[b][k]=m,h[b][l]=n;for(var o in j)h[b][o]=c.isFunc(j[o])?j[o].bind(j):j[o];return h}if(c.event)return!0;var f=c.event={},g=c.guid(),h=0,i=function(){var a=[];if(!arguments.length)return"";for(var b=0;b<arguments.length;b++)a.push(arguments[b]);a[0]&&(a[0]=a[0].lowerChar0());for(var b=1;b<arguments.length;b++)a[b]=a[b].uperChar0();return a.join("")};f._event={eventList:{},add:function(a,b,c){b=b||"default",this.eventList[b]||(this.eventList[b]=[]);var d={func:a,data:c};this.eventList[b].push(d)},execute:function(a,b,d){a=a||"default",this.eventList[a]=this.eventList[a]||[],b=b||c.event._event;var e=!0;return this.eventList[a].each(function(a){if(d&&d.length>=0){for(var c=[],f=0;f<d.length;f++)c.push(d[f]);a.data&&c.push(a.data),e=e&&!(0==a.func.apply(b,c))}else e=e&&!(0==a.func.call(b,d,a.data))}),e},clear:function(a){this.eventList[a]=[]}},f.events=f._event.eventList,f.register=function(a,b){if(f._event[a])return f._event[a];var d=function(d,e){return"function"!=typeof d?(e=e||d,b=b||e,c.event._event.execute(a,b,e)):void c.event._event.add(d,a,e,b)};return d.clear=function(){f._event.clear(a)},d.eventList=function(){return f._event.eventList[a]},d.execList=function(){},f._event[a]=d,d},f.registerOn=function(a,b,d){var e=c.getHash(a)+"_"+b;return this.register(e,d)},f.remove=function(a){f._event[a]&&delete f._event[a]},f.clear=function(a){f._event.clear(a)},f.hook=function(a,b,d){d=d||c.getHash(a),b.split(",").each(function(b){b&&e(a,b,d)})},f.unhook=function(a,b){a[b]&&a[b]._orgFunc&&(a[b]=a[b]._orgFunc)},f.get=function(b,c){if(c||(c=a),c.jquery)return c.each(function(){f.registerOn(this,b,this,this)}),function(){var a=arguments,d=!0;return c.each(function(){d=d&&f.registerOn(this,b,this,this).apply(this,a)}),d};var d=this.registerOn(c,b,c,c);return d}}(avril.$,avril),function(b){if(b.createlib)return b.createlib;var c={uperChar0:function(a){var b=a.charAt(0),c=b.toUpperCase();return a.replace(new RegExp("^"+b),c)},lowerChar0:function(a){var b=a.charAt(0),c=b.toLowerCase();return a.replace(new RegExp("^"+b),c)}},d=0,e=function(){var a=[];if(!arguments.length)return"";for(var b=0;b<arguments.length;b++)a.push(arguments[b]);a[0]&&(a[0]=c.lowerChar0(a[0]));for(var b=1;b<arguments.length;b++)a[b]=c.uperChar0(a[b]);return a.join("")},f={},g=function(c,g,h,i,j){if(j=j||a,b.object(j).tryGetVal(c))return b.object(j).tryGetVal(c);b.object(j).setVal(c,function(a){function h(a,b,c){var d=b[a],e=c[a];if(d!=e){var f=s([a,b,c]);f&&(c[a]=b[a],r([a,b,c]))}}function k(a,f){b.event.hook(a,f,c+"["+d+"].");var g=g||"before",h=h||"on",i=e(g,f),j=e(h,f);return a.events[i]=a[f][i],a.events[j]=a[f][j],a}function l(a,b){if(!a)return!1;var c=b.events;for(var d in a)c[d]&&"function"==typeof a[d]&&(1==a.clearAllEvents&&c[d].clear(),c[d](a[d]))}d++;var m=b.object(j).getVal(c);if(!(this instanceof m))return new m(a);var n=this;if(i){b.isStr(i)&&(i=b.object(j).getVal(i));var o=i(a);b.object(o).each(function(a,b){n[a]=b}),n._getSuper=function(){return o}}else{n._getSuper=function(){return null},n.events={};var p=b.guid(),q=f[p]={},r=b.event.register(c+"["+d+"].onPropertyChange"),s=b.event.register(c+"["+d+"].beforePropertyChange");l(a,n),n.options=function(a,b){if(arguments.length>0){if("object"==typeof a)for(var c in a)h(c,a,q);else if("string"==typeof a){var c=a,a={};a[c]=b,h(c,a,q)}return l(a,this),this}return q},n.events.beforeOptionChange=s,n.events.onOptionChange=r,n.hook=function(a){var b=this;return"string"==typeof a&&(a.indexOf(",")>=0?a.split(",").each(function(a){k(b,a)}):k(b,a)),b},n._prop=function(a,c,d){b.createlib.getset(n,a,c,d)},n._parseConfig=function(a){b.createlib.parseConfig(n,a)}}"function"==typeof g&&(g.call(this,a),l(a,this))});var k=b.object(j).getVal(c);$.extend(k,h);var l=k.toString;return k.toString=function(a){return a?l.call(k):"type [ "+c+" ] "},k.toJQ=function(a,b){var c=a;a+="API",$.fn[c]=function(c){{var d=arguments;this.each(function(){var d=$(this);if(d.data(a))var e=d.data(a);else{var f={};"function"==typeof b?b.call(d,f):"string"==typeof b&&(f[b]=d);var e=new k($.extend({},c,f));d.data(a,e),"function"==typeof e.init&&e.init()}})}if(0!=this.length&&this.data(a)){var e=this.data(a);if(1==d.length){if("string"==typeof d[0])return e[d[0]]}else if(d.length>1&&"string"==typeof d[0]&&e[d[0]]){if("function"==typeof e[d[0]]){for(var f=[],g=1;g<d.length;g++)f.push(d[g]);return e[d[0]].apply(e,f)}e[d[0]]}}return this}},fnName=c.replace(new RegExp("\\.","gi"),"_"),$.fn[fnName]||($.fn[fnName]=function(a){return this.each(function(){var b=$(this),d=$.extend({$:b},a),e=k(d);b.data(c,e)}),this}),k},h=function(a,c,d,e,f){var g=b.createlib(c,d,e,a,f);return g};b.createlib=g,b.createlib.getset=function(a,c,d,e){a[c]=function(a,c,d,e){var f={value:void 0};return function(){return 0==arguments.length?b.isFunc(d)?d.call(f,f.value):f.value:(b.isFunc(e)?e.call(f,arguments[0]):f.value=arguments[0],a)}}(a,c,d,e)},b.createlib.parseConfig=function(a,c){b.object(a.options()).each(function(d){if(0==d.indexOf("$")&&!a[d]){var e,f=b.guid();b.createlib.getset(a,d,function(){return f!=a.options()[d]&&(f=a.options()[d],e=(c||$)(a.options()[d])),e},function(b){a.options(d,b)})}})},b.createlibOn=function(a,c,d,e,f){return b.createlib(c,d,e,f,a)},b.extendlib=h,b.createlib.beautifyFunName=e,function(){b.object.instanceOf;b.object.instanceOf=function(a,c){var d=a instanceof c;if(d)return!0;if(b.isFunc(a._getSuper)){var e=a._getSuper();if(d=e instanceof c)return!0;if(null!=e)return b.object(e).instanceOf(c)}return d}}()}(avril),void(a.console||(a.console={},a.console.log=function(){})))}(this),function($,avril){avril.namespace("avril.tools");var _cache={};!function(a){return a.request?!1:void(a.request=function(){function b(b){var c={};c.queryString=function(){if(b.indexOf("?")<0)return{};for(var a,c={},d=function(a){return decodeURIComponent(a.replace(/\+/g," "))},e=b.substring(b.indexOf("?")+1),f=/([^&=]+)=?([^&]*)/g;a=f.exec(e);)c[d(a[1])]=d(a[2]);return c}();var d=function(b,d){var e=!1;return a.object(c.queryString).each(function(a){b.toLower()==a.toLower()&&(e=!0,c.queryString[a]=d)}),e||(c.queryString[b]=d),c},e=function(b){var d;return a.object(c.queryString).each(function(a,c){b.toLower()==a.toLower()&&(d=c)}),d};return c.param=function(a,b){if(0==arguments.length)return this;if(1==arguments.length){if("string"==typeof a)return e(a);if("object"==typeof a)for(var c in a)d(c,a[c]);return this}return 2==arguments.length?d(a,b):void 0},c.getUrl=function(){var a=b.split("?")[0];a.indexOf("?")<0&&(a+="?");for(var d in c.queryString)null!=c.queryString[d]&&(a+=d+"="+encodeURI(c.queryString[d])+"&");return a.lastIndexOf("&")==a.length-1?a.substring(0,a.lastIndexOf("&")):a.lastIndexOf("?")==a.length-1?a.substring(0,a.lastIndexOf("?")):a},c.toString=function(){return this.getUrl()},c}return $.extend(b,b(window.location.href)),b}())}(avril),avril.namespace("avril.tools.loader"),avril.tools.loader.extend({jsonp:function(options){function removeScript(){function a(){try{(head?head[0]:document).removeChild(script)}catch(a){}try{delete window[jsonpcallback]}catch(a){}}"undefined"==typeof script.jsonp&&options.error(),setTimeout(function(){a()},5e3)}options.success=options.success||function(){},options.error=options.error||function(){};var jsonpcallback="avril_"+avril.guid();window[jsonpcallback]=function(){if(script.jsonp=!0,options.success){var obj=arguments[0];"string"==typeof obj&&(obj=eval("("+obj+")")),options.success(obj)}};var script=document.createElement("script");script.type="text/javascript",script.language="javascript",script.charset="utf-8",script.async=!0;var head=document.getElementsByTagName("head");head[0].appendChild(script),script.onload=script.onreadystatechange=function(){(-[1]||/loaded|complete/i.test(this.readyState))&&removeScript()},script.onerror=function(){removeScript()};var request=avril.request(options.url);options.data&&avril.object(options.data).each(function(a,b){"function"!=typeof b&&"object"!=typeof b&&request.param(a,encodeURIComponent(b))}),request.param(options.jsonp||"jsonpcallback",jsonpcallback),script.src=request.getUrl()},json:function(a){a.url&&0==a.url.indexOf("http")&&a.url.indexOf("http://"+document.location.host)<0&&a.url.indexOf("https://"+document.location.host)<0?this.jsonp(a):$.ajax(a)},loadScript:function(a,b){callbackCache.hasOwnProperty(a)?b():(loadingList.push(a),callbackCache[a]=b||function(){},1==loadingList.length&&this._loadScript())},loadStyle:function(a){var b=document.getElementsByTagName("head")||document.getElementById("body"),c=document.createElement("link");c.rel="Stylesheet",c.type="text/css",(b?b[0]:document).appendChild(c),c.href=a},template:function(a,b){var c=avril.tools.cache(a);c?b(cache):$.get(a,function(c){b(c),avril.tools.cache(a,c)})}}),avril.createlib("avril.tools.Communicator",function(a){var b=$.extend(this.options(),{targetWindow:window},a),c=this,d=avril.event.registerOn(this,"init",this,this),e=_cache._cacheData={},f=[];d(function(){if(window.postMessage)window.addEventListener?window.addEventListener("message",function(a){h([$.parseJSON(a.data).data])},!1):window.attachEvent&&window.attachEvent("onmessage",function(a){h([$.parseJSON(a.data).data])});else{var a="";setInterval(function(){window.name!==a&&(a=window.name,h([$.parseJSON(a).data]))},1)}}),this.targetWindow=b.targetWindow,this.init=function(a){return a&&this.options(a),d([this]),this};var g=function(a,c){var d=avril.guid()+"_guid";a.guid=d,a.needFeedback=!!c,a=$.toJSON({data:a,guid:d}),e[d]=[];var f=0;!function g(){b.targetWindow.postMessage?b.targetWindow.postMessage(a,"*"):function(){b.targetWindow.name=a}(),c&&f++<1e4&&e[d].push(setTimeout(g,500+f))}()},h=avril.event.registerOn(this,"onMessage",this,this),i=this.onFeedback=avril.event.registerOn(this,"onFeedback",this,this),j=this.commandType={im:"im",command:"command",feedback:"feedback",message:"message"};this.postCommand=function(a){2==arguments.length&&(a={name:arguments[0],data:arguments[1]}),g({type:j.command,data:a},!0)},this.onCommand=avril.event.registerOn(this,"onCommand",this,this),this.postIM=function(a){g({type:j.im,data:a},!0)},this.onIM=avril.event.registerOn(this,"onIM",this,this),h(function(a){if(f.contain(a.guid))return!1;var b=!0;switch(a.type){case j.command:b=c.onCommand([a.data]);break;case j.im:b=c.onIM([a.data]);break;case j.feedback:b=i([a.data])}b&&(f.push(a.guid),a.needFeedback&&g({type:j.feedback,data:a.guid}))}),i(function(a){_cache._cacheData[a]&&_cache._cacheData[a].each(function(a){try{clearTimeout(a)}catch(b){}})}),this.events.onOptionChange(function(a,b){"targetWindow"==a&&(c.targetWindow=b.targetWindow)})}),avril.tools.Communicator.current=avril.tools.Communicator(),avril.tools.cache=function(){var a=window.localStorage||{},b=function(b,c){switch(arguments.length){case 0:return a;case 1:return a[b];case 2:return a[b]=c}};return b.del=function(b){delete a[b]},b.delByPre=function(c){for(var d in a)0==d.indexOf(c)&&b.del(d)},b.list=function(a,c){function d(c){return c.save=function(){b.list(a,c)},c}switch(arguments.length){case 1:var e=[];if(b(a)){var c=$.parseJSON(b(a)).data;return d(c),c}return d(e);case 2:if(c instanceof Array)return b(a,$.toJSON({data:c})),d(c);var e=[c];return b(a,$.toJSON({data:e})),d(e)}},b.object=function(a,c){function d(c){return c=c||{},c.save=function(){return b.object(a,c),c},c}switch(arguments.length){case 1:return c=b(a),c?d($.parseJSON(c).data):d();case 2:return b(a,$.toJSON({data:c})),d(c)}},b.localStorage=!!window.localStorage,b}(),function(){avril.createlib("avril.tools.Localize",function(a){var b=$.extend(this.options(),{url:"/resources/localize",datatype:"jsonp",version:"0.1",language:"default",type:"post"},a);this.parse=function(a,c){if(0==b.enabled)return!1;var d=$(a).is("[data-localize]")?$(a):$(c?"[data-localize]":"[data-localize][data-localize!=true]",a||"body"),e=avril.tools.cache.list(b.language),f=[],g=[],h=function(a){return e.first(function(b){return b.key==a})};d.each(function(){var a=$(this);if(a.is("[data-localize]")){var b=h(a.html());null==b?(f.push(a.html()),g.push(a)):a.html(b.text)}}),f.length>0&&$.ajax($.extend({data:{data:f},success:function(a){a.each(function(a,b){a=unescape(a),g[b].html(a).attr("localize","true");var c=e.first(function(a){return a.key==f[b]});null==c?e.push({key:f[b],text:a}):c.text=a}),e.save()}},b))}}),avril.tools.localize=avril.tools.Localize()}()}($,avril),function(a){return a.validator?(avril.namespace("avril.validator"),function(){var b=a.validator.prototype.showLabel;a.validator.prototype.showLabel=function(a){var c=b.apply(this,arguments);return this.errorsFor(a).addClass("help-block"),c}}(),avril.validator.extend({parseForm:function(b){var c=this;return b=a(b),b.each(function(){a.data(this,"validator",null),a(this).validate(c.getValidObj(a(this)))}),this},getValidObj:function(b,c){var d=c,e=d&&d.errCls||"has-error",f=d&&d.errCls||"has-success";d||(d={rules:{},errorElement:"small",messages:{},success:function(b){a(b).parent().removeClass(e).addClass(f),b.remove(),b.addClass("help-block")},errorPlacement:function(b,c){a(c).after(b),b.addClass("help-block"),b.hide(),a(c).parent().removeClass(f).addClass(e)}});var g=this;return b.find("input,select,textarea").each(function(){g.parseInput(a(this),d)}),d},parseInput:function(a,b){var c=this,d=a.attr("name"),e=a[0],f=e.attributes,g=[],h="data-val-";if(d||a.attr("name",d="input-name-"+avril.getHash(a)),"true"===a.attr("data-val")&&a.is(":enabled")){b.rules[d]||(b.rules[d]={}),b.messages[d]||(b.messages[d]={});for(var i=0;i<f.length;i++)g.push(f[i]);{g.each(function(e){var f=e.name;if(e.name.indexOf(h)>=0){var i=c._getOrgAttrName(f.replace(h,""));if(i.indexOf("-")<0){var j=a.attr("data-val-msg-"+i)||a.attr(f);b.messages[d][i]=j,c._getRuleParam(a,f,i,g,b),b.rules[d][i]||(b.rules[d][i]=!0)}}})}}},_getOrgAttrName:function(a){var b={equalto:"equalTo",dateiso:"dateISO"};return b[a]||a},_getRuleParam:function(a,b,c,d,e){var f=a.attr("name"),g=this;d.each(function(d){0==d.name.indexOf(b)&&(e.rules[f][c]=g._paramAdapter[c]?g._paramAdapter[c](a.attr(d.name),a):a.attr(d.name))})},_paramAdapter:{required:function(){return!0},range:function(a){return a.split(",").select(function(){return Number(this)})},rangelength:function(a){return a.split(",").select(function(){return Number(this)})}}}),void a.each(["minlength","maxlength","min","max"],function(){avril.validator._paramAdapter[this]=function(){return Number(arguments[0])}})):!1}(jQuery),function(a){String.prototype.localize=function(){return $(a.ui.helper.$span().html(this.toString()).localize())[0].outerHTML},a.toArray=function(a){var b=[];if(a.length)for(var c=0;c<a.length;c++)b.push(a[c]);return b}}(avril),avril.namespace("avril.ui"),function(a){var b="localizeKey";$.fn.localize=function(c){var d=this;return this.data(b,this.data(b)||this.html()),this.attr("data-localize","false"),c&&this.attr("data-loaclize-group",c),a.tools.localize.parse(d),this};var c=a.ui.helper={divStr:"<div/>",linkStr:"<a/>",tagBuilder:function(a,b){var c=$(this.tagStr[a]);return b&&c.attr(b),c},localize:{},tagStr:{}},d="a,abbr,acronym,address,applet,area,b,base,basefont,bdo,big,blockquote,body,br,button,canvas,caption,center,cite,code,col,colgroup,dd,del,dfn,dir,div,dl,dt,em,fieldset,font,form,frame,frameset,h1,h2,h3,h4,h5,h6,head,hr,html,i,iframe,img,input,ins,isindex,kbd,label,legend,li,link,map,menu,meta,noframes,noscript,object,ol,optgroup,option,p,param,pre,q,s,samp,script,select,small,span,strike,strong,style,sub,sup,table,tbody,td,textarea,tfoot,th,thead,title,tr,tt,u,ul,var";d.split(",").each(function(a){var b="$"+a;c.tagStr[a]="<"+a+"/>",c[b]=function(b){return c.tagBuilder(a,b)},c.localize[b]=function(a,d){var e=c[b].apply(c,arguments);return e.localize(d),e}}),function(){var a=c.$a;c.$a=function(b){b&&b.href||(b=b||{},b.href="javascript:;"),a.call(c,b)}}()}(avril),function(a,b){b.createlib("avril.ui.msg",function(c){function d(a,b){a.show(),a.removeClass("alert-success alert-error alert-info").addClass("alert-"+b.type),a.find("strong").html(b.title),a.find("span").html(b.msg)}var e,f=a.extend(!0,this.options(),{$container:"body"},c),g=function(){e=a('<div class="alert" style="display:none;"> <button type="button" class="close" data-dismiss="alert">×</button> <strong/>:  <span/>  </div>').attr("guid",b.guid()),e.find("button").click(function(){e.fadeOut()})};this._parseConfig(),this.show=function(a,b){return 1==arguments.length?(b=arguments[0],a=this.$container()):2==arguments.length&&(f.$container=a),0==a.children("div.alert").length?(g(),e.prependTo(a)):e=a.find("div.alert"),d(e,b),this},this.showInBody=function(a){return f.$container="body",this.show("body",a),this}})}(jQuery,avril),function($,avril){function initDialog(a){if(a.options().buttons){var b=a,c=a.options(),d=function(){var b=a.$pop().find(".modal-footer");return b.length||(a.$pop().find(".modal-body").after($('<div class="modal-footer"></div>')),b=a.$pop().find(".modal-footer")),b};if(a.onButtonClick=avril.event.get("onButtonClick",a),c.buttons){var e=d();e.html(""),c.buttons.each(function(a){var c=a,d=a,f="btn";"object"==typeof a&&(c=a.name,d=a.text,f=a.cls=a.cls||"btn","function"==typeof a.fun&&b.onButtonClick(function(b,d){b==c&&a.fun(b,d)})),$('<a href="javascript:;"/>').addClass(f).html(d).localize().attr("data-btn-name",c).click(function(){b.onButtonClick([c,$(this)])}).appendTo(e)})}a.$pop().find(".modal").css("min-height","none")}}var popList=[],_divStr='<div style="display:none;" class="row"><div class="modal-backdrop fade in"></div>                  <div class="modal">                   <div class="modal-header">                     <button type="button" class="close">×</button>                     <h3>Untitle</h3>                   </div>                   <div class="modal-body">                                       </div>                 </div></div>';avril.createlib("avril.ui.pop",function(a){var b=$.extend(this.options(),{autoSize:!0,$handle:null,draggable:!1,resizable:!0,effect:"puff",effectTime:250,easing:"easeInExpo",title:"",esc:!0},a),c=!1,d=this,e=function(){return d.$pop().find(".modal")},f=function(){return e().find(".modal-body")},g=function(){return e().find(".modal-header")};this._parseConfig($),this.$modal=e,this.$body=f,this.$header=g,this.$pop=function(a){return a&&(this._$pop=a),$(this._$pop)},this.init=function(){if(!this._inited){{this.$pop($(_divStr).appendTo("body"))}h(this.$handle()),i(),j(),k(b.width,b.height),l(b.title),d.events.onLoadHandle(function(){f().find(".close-pop").click(function(){d.hide()}),k(b.width,b.height)}),this._inited=!0}return this},this.load=function(a,b){function c(a){if(d.events.onLoad([a])){d.$pop().find("div.modal-body").html(a);var c=d.$pop().find(".modal-body h3:eq(0)").hide();d.$pop().find(".modal-header h3:eq(0)").html(c.html()),d.events.onLoadHandle([d.$pop(),d]),d.events.onContentReady([]),b&&b()}}this.events.beforeLoad([d])&&$.ajax({url:a,success:c,error:function(){d.hide()}})},this.show=function(){popList.push(this),this.init(),this.$pop().show(),this.$pop().find(".modal-backdrop").css("z-index",avril.ui.getZindex()+2).css("opacity",.6),this.$pop().find(".modal").hide().show(b.effect,{to:d.$handle(),easing:b.easing},b.effectTime,function(){d.$pop().find(".modal-backdrop").css("z-index",avril.ui.getZindex()+1),d.$pop().find(".modal").css("z-index",avril.ui.getZindex()+1),m()}),this.$pop().find(".close,.close-pop,button[type=reset]").click(function(){d.hide()})},this.hide=function(){popList.remove(function(a){return a==d}),this._inited=!1,this.$pop().find(".modal").hide(b.effect,{to:d.$handle(),easing:b.easing},b.effectTime,function(){d.$pop().remove()})},this.disable=function(){c=!0};var h=function(a){if(a&&a.length){var c=a.attr("href"),e=!1;c.indexOf("#")>0&&(b.$pop=c.substring(c.indexOf("#")),e=!0),a.click(function(a){a.preventDefault(),e||d.load($(this).attr("href")),d.show()})}},i=function(){d.$pop().find(".modal").draggable({handle:".modal-header h3"}),b.draggable?(d.$pop().find(".modal").draggable("enable"),d.$pop().find(".modal").css({position:"absolute"}),d.$pop().find(".modal h3").css({cursor:"move"})):(d.$pop().find(".modal").css({position:"fixed"}),d.$pop().find(".modal").draggable("disable"),d.$pop().find(".modal h3").css({cursor:"default"}),d.$pop().find(".modal").removeClass("ui-state-disabled")),m()},j=function(){d.$pop().find(".modal").resizable(),b.resizable||(d.$pop().find(".modal").resizable("disable"),d.$pop().find(".modal").removeClass("ui-state-disabled"))},k=function(a,b){void 0!==a&&e().width(a),void 0!==b&&e().height(b)},l=function(a){return g().find("h3").html(a)},m=function(){var a=d.$pop().find(".modal"),c=$(window).height(),e=$(window).width(),f=a.width(),g=a.height(),h=0,i=0;c>g&&(h=(c-g)/2+(b.draggable?$(window).scrollTop():0)),e>f&&(i=(e-f)/2),a.clearQueue().animate({top:h+"px",left:i+"px"})};this.makePositionCenter=m,d.hook("show,hide"),this.events.beforeLoad=avril.event.get("beforeLoad",this),this.events.onLoad=avril.event.get("onLoad",this),this.events.onLoadHandle=avril.event.get("onLoadHandle",this),this.events.onContentReady=avril.event.get("onContentReady",this),this.events.onHide=avril.event.get("onHide",this),this.events.onOptionChange(function(a,b){switch(a){case"content":d.$pop().find(".modal-body").html(b[a]),avril.tools.localize.parse(d.$pop()),d.events.onLoadHandle([d.$pop(),d]),d.events.onContentReady([]);break;case"title":l(b[a]);break;case"width":k(b[a]);break;case"height":k(void 0,b[a]);break;case"draggable":i();break;case"resizable":j()}}),this.show.onShow(function(){setTimeout(m,700),f().on("keyup","input,textarea,select",function(a){a.stopPropagation()})}),$(window).resize(m)}),avril.alert=function(a,b){b=b||function(){};var c=avril.ui.pop({resizable:!1,alert:"Alert",title:"Alert",buttons:[{text:avril.alert.text.OK||"OK",name:"OK",cls:"btn btn-primary"}],showFooter:!0}).init();c.$header().find("h3").html(avril.alert.text.Alert||"Alert"),initDialog(c),c.options("content",a).show(),c.onButtonClick(function(){b(),c.hide()}),c.$pop().find("a:eq(0)").focus()},avril.alert.text={OK:"确定",Alert:"警告"},avril.confirm=function(a,b){b=b||function(){};var c=avril.ui.pop({resizable:!1,title:"Confirm",buttons:[{text:avril.confirm.text.Confirm||"Confirm",name:"Confirm",cls:"btn btn-primary"},{text:avril.confirm.text.Cancel||"Cancel",name:"Cancel",cls:"btn btn-danger"}],showFooter:!0}).init();c.$header().find("h3").html(avril.confirm.text.Confirm||"Confirm"),initDialog(c),c.options("content",a).show(),c.show.onShow(function(){c.$pop().find('[data-btn-name="Confirm"]').focus()}),c.onButtonClick(function(a){switch(a){case"Confirm":b(!0),c.hide();break;case"Cancel":b(!1),c.hide()}}),c.$pop().find("a:eq(0)").focus()},avril.confirm.text={Confirm:"确认",Cancel:"取消"},avril.prompt=function(a,b,c){function d(){var a=b(e.$body().find("input").val())!==!1;a&&e.hide()}b=b||function(){};var e=avril.ui.pop({resizable:!1,title:"Prompt",buttons:[{text:"Ok",name:"Ok",cls:"btn btn-primary"},{text:"Cancel",name:"Cancel",cls:"btn btn-danger"}],showFooter:!0}).init();e.$header().find("h3").localize(),initDialog(e),e.options("content",a+'<br/><br/><input class="input-xxlarge" value="'+(c||"")+'" /> ').show(),e.$pop().find("input").keyup(function(a){13==a.keyCode&&d()}),e.onButtonClick(function(a){switch(a){case"Ok":d();break;case"Cancel":e.hide(!1)}})},avril.ui.pop.open=function(a){var b=new avril.ui.pop;b.load(a),b.show()},avril.ui.pop.toJQ("pop",function(options){if(this.attr("data-pop"))try{$.extend(!0,options,eval("("+this.attr("data-pop")+")"))}catch(E){}options.$handle=this}),avril.ui.popContext={popList:function(){return popList},getCurrent:function(){return popList&&popList.length?popList[popList.length-1]:null}},$(window).keyup(function(a){if(27==a.keyCode){var b=avril.ui.popContext.getCurrent();b&&b.options().esc&&b.hide()}})}(jQuery,avril),function(avril){avril.namespace("avril.ui"),avril.ui.cookie={get:function(a){var b=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)"));return null!=b?unescape(b[2]):null},set:function(a,b,c){c=c||30;var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3),document.cookie=a+"="+escape(b)+";expires="+d.toGMTString()},del:function(a){var b=new Date;b.setTime(b.getTime()-1);var c=this.get(a);null!=c&&(document.cookie=a+"="+c+";expires="+b.toGMTString())},getObj:function(key){return window.JSON?window.JSON(this.get(key)):eval("("+this.get(key)+")")},setObj:function(a,b){this.set(a,window.JSON?window.JSON.stringify(b):$.toJSON(b))}}}(avril),function(a,b){b.createlib("avril.ui.progressbar",function(c){function d(){e(),g.stop=!1;var a=0;f=setInterval(function(){100==a++&&(a=0),g.stop||(h.progressbar("value",a),h.css("z-index",b.ui.getZindex()+2))},50)}function e(){g.stop=!0;try{clearInterval(f)}catch(a){}}{var f,g=a.extend(!0,this.options(),{auto:!0,stop:!1},c),h=b.ui.helper.$div().css({width:g.width||250,height:g.height||20,position:g.position||"fixed",bottom:g.bottom||0,right:g.right||0,display:"none"}).appendTo("body");b.guid()}h.progressbar(),g.auto&&d(),this.show=function(){return h.show(),d(),this},this.hide=function(){return h.hide(),e(),this},this.$el=h},{bottom_right:function(){var a;return function(){return a||(a=b.ui.progressbar()),a}}()})}(jQuery,avril),function($,avril){!function(a,b,c){"$:nomunge";function d(a){return a=a||location.href,"#"+a.replace(/^[^#]*#?(.*)$/,"$1")
}var e,f="hashchange",g=document,h=a.event.special,i=g.documentMode,j="on"+f in b&&(i===c||i>7);a.fn[f]=function(a){return a?this.bind(f,a):this.trigger(f)},a.fn[f].delay=50,h[f]=a.extend(h[f],{setup:function(){return j?!1:void a(e.start)},teardown:function(){return j?!1:void a(e.stop)}}),e=function(){function e(){var c=d(),g=n(k);c!==k?(m(k=c,g),a(b).trigger(f)):g!==k&&(location.href=location.href.replace(/#.*/,"")+g),h=setTimeout(e,a.fn[f].delay)}var h,i={},k=d(),l=function(a){return a},m=l,n=l;return i.start=function(){h||e()},i.stop=function(){h&&clearTimeout(h),h=c},a.browser.msie&&!j&&function(){var b,c;i.start=function(){b||(c=a.fn[f].src,c=c&&c+d(),b=a('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){c||m(d()),e()}).attr("src",c||"javascript:0").insertAfter("body")[0].contentWindow,g.onpropertychange=function(){try{"title"===event.propertyName&&(b.document.title=g.title)}catch(a){}})},i.stop=l,n=function(){return d(b.location.href)},m=function(c,d){var e=b.document,h=a.fn[f].domain;c!==d&&(e.title=g.title,e.open(),h&&e.write('<script>document.domain="'+h+'"</script>'),e.close(),b.location.hash=c)}}(),i}()}(jQuery,this),avril.createlib("avril.ui.ajaxframe",function(options){function _isAjaxHash(){var a=window.location.hash;return 0==a.indexOf(config.identifyPre)?!0:!1}function _getUrl(){return window.location.hash.substring(1)}function _getCache(a){return cache[a||_getUrl()]}function setContent(a,b){0!=b?self.$container().hide(config.hideEffect||config.effect,function(){self.$container().html(a),self.onLoad([self,self.$container()]),self.$container().show(config.showEffect||config.effect)}):(self.$container().html(a),self.onLoad([self,self.$container()]))}function loadContent(url,hasEffect){self._lasturl=url,_getCache(url)&&config.cache?config.cache&&_getUrl(url)&&setContent(_getCache(url)):$.ajax({url:url,data:{_avril_guid:avril.guid()},success:function(response){var isJSON=!1,obj;try{var json=$("<div/>").html(response).text();obj=eval("("+json+")"),isJSON=!0}catch(E){}isJSON?response.innerType?avril[response.innerType](response.msg,function(){avril.event.get("response."+response.innerType)(avril.toArray(arguments).push(url))}):avril.ui.msg().show("body>div.container.main-page",obj):(cache[url]=response,setContent(response,hasEffect))}})}var config=$.extend(this.options(),{identifyPre:"#/",$container:"#ajax-container",showEffect:"slide",hideEffect:"slide",enabled:!0,cache:!1},options),self=this,_firstContent,cache={},triggerChange=!0;this._parseConfig(),this.loadContent=loadContent,this.onLoad=avril.event.get("onLoad",this),this.reload=function(){return self._lasturl&&this.loadContent(self._lasturl,!1),this},this.beforeLoad=avril.event.get("beforeLoad",this),this.navTo=function(a){this.options().enabled&&(window.location="#"+a,triggerChange=!1,this.loadContent(a))},this.parseLink=function(a){$(a).each(function(){$(this).data("ajaxframe-parse")||$(this).is(".no-ajax")||($(this).click(function(a){self.options().enabled&&(a.preventDefault(),self.navTo($(this).attr("href")))}),$(this).data("ajaxframe-parse",!0))})},this.init=function(){_firstContent=this.$container().html(),$(window).hashchange(function(){self.options().enabled&&(triggerChange&&_isAjaxHash()?self.loadContent(_getUrl()):triggerChange&&!window.location.hash&&setContent(_firstContent)),triggerChange=!0}),_isAjaxHash()&&self.options().enabled&&self.loadContent(_getUrl(),!1),this.parseLink("a.ajaxlink")},this.getUrl=function(){return _getUrl()}}),window.ajaxFrame=avril.ui.ajaxframe()}(jQuery,avril),function(){avril.ui.getZindex=function(){var a=$("*").toArray(),b=a.select(function(a){var b=$(a).css("z-index");return b&&!isNaN(b)?parseInt(b):0}).sort().pop();return b}}(),function(a){function b(){var b=a(this);if(b.data("loadingCover"))b.data("loadingCover").show();else{var c="<div/>",d=a(c).css({position:"absolute"}).addClass("loading-cover"),e=(a(c).addClass("mask").appendTo(d),a(c).addClass("loading-img").appendTo(d)),f=function(){{var b=a(window);b.height(),b.width()}e.css({top:"50%",position:"fixed"})},g=function(){d.css({width:b.width(),height:b.height(),top:b.offset().top,left:b.offset().left,"z-index":avril.ui.getZindex()+1}),e.css({left:b.width()/2-16,top:b.height()/2-16})},h={adjust:g,remove:function(){d.remove(),b.data("loadingCover",null)},hide:function(){d.hide()},show:function(){g(),d.show()},cover:function(){return d}};avril.ui.loadingCover.removeAll(h.remove),avril.ui.loadingCover.hideAll(h.hide),d.appendTo("body"),g(),a(window).resize(function(){g()}),b.is("body")&&f(),b.data("loadingCover",h)}}avril.namespace("avril.ui.loadingCover"),avril.ui.loadingCover.removeAll=avril.event.register("avril.ui.loadingCover.removeAll"),avril.ui.loadingCover.hideAll=avril.event.register("avril.ui.loadingCover.hideAll"),a.fn.loadingCover=function(a){return this.each(function(){b.call(this,a)}),this},a(function(){a("body").loadingCover(),avril.ui.loadingCover.hideAll()})}(jQuery),avril.module.notify("avril.ui"),function(a){var b=avril.namespace("avril.mvc.config"),c="/resources/config";a.extend(b,{templateUrl:"/resources/template",release:!1,configUrl:c,defaultLoadData:!1}),b.load=function(c){var d=function(b){a.extend(avril.mvc.config,b)},e=function(a){a=a||{},a.requestReady=!0,d(a),avril.mvc.config.onload([avril.mvc.config])};"string"==typeof c?(b.configUrl=c,a.getJSON(c.configUrl,e)):c&&"object"==typeof c?(d(c),c.configUrl?a.getJSON(c.configUrl,e):e(c)):a.getJSON(b.configUrl,e)},b.onload=function(a){b.requestReady&&"function"==typeof a?a():avril.event.get("avril.mvc.config.onload")(a)},b.onload(function(a){var b=avril.tools.cache("version");b!=a.version&&(avril.tools.cache("version",a.version),avril.mvc.config.onVersionChange([b,a.version]))}),b.ensure=function(a,c){var d=c.split(",");d.each(function(c){function d(b){return a[c]=e,e.apply(a,b)}if("function"==typeof a[c]){var e=a[c];a[c]=function(){var a=arguments;return b.requestReady?d(a):void b.onload(function(){d(a)})}}})},b.onVersionChange=avril.event.get("avril.mvc.config.onVersionChange"),function(){var a={"0__hashkey":avril.getHash({})},b=function(c,d){if(c=c||avril.getHash({}),a[c])return a[c];var e=a[c]={__hashkey:avril.getHash({}),_models:{},model:function(a,b){if(!a)return void 0;var c=this._models;return c[a]?2==arguments.length&&c[a](b):(1==arguments.length&&(c[a]=ko.observable()),!(b instanceof Array)&&2==arguments.length&&(c[a]=ko.observable(b)),b instanceof Array&&2==arguments.length&&(c[a]=ko.observableArray(b))),c[a]},parentPool:d,getPool:function(a){return b(a,this)}};return e},c=avril.mvc.models=b("0_default",a);c.pools=a}();var d=avril.mvc.models,e=avril.mvc.controllers={_controllers:{},controller:function(a,b,c){var d=this._controllers;switch(arguments.length){case 0:return null;case 1:var e=avril.object(d).getVal(a);if(e)return e();throw Error("controller "+a+" is undefined.");case 2:case 3:var f=b;return"object"==typeof b&&(f=function(){avril.extend(this,b)}),avril.createlibOn(d,a,f,null,c),this}}};e.controller("avril.common.formBase",function(){var b={},c=this;this.init=function(a,b){return b&&this.model(b),a&&this.postUrl(a),this},this.model=ko.observable(),this.postUrl=ko.observable(),this.fields=d.getPool(),this.fields.field=function(a,d){b[a]||(b[a]=this.model(a,d));var e=b[a],f=c.model();return 1==arguments.length&&f&&void 0===e()&&e(avril.object(f).tryGetVal(a)),e},this.getFormData=function(){var a={};for(var b in this.fields._models)avril.object(a).setVal(b,this.fields.model(b)());return a},this.submit=function(b,e){if(!this.postUrl()&&this.postUrl(e.parents("form").attr("action")),!this.postUrl())throw new Error("post url is required.");a.post(avril.request(this.postUrl()).param("appId",d.model("meta.selectedApp")()).getUrl(),this.getFormData()).success(function(){c.submit.beforeSuccess(avril.toArray(arguments))&&c.submit.onSuccess(avril.toArray(arguments))}).error(function(){c.submit.onError(avril.toArray(arguments))})},this.submit.onSuccess=avril.event.get("form.onSuccess",this),this.submit.beforeSuccess=avril.event.get("form.beforeSuccess",this),this.submit.onError=avril.event.get("form.onError",this),this.hook("submit,init")});var f=avril.namespace("avril.mvc.request"),b=avril.mvc.config,g="template-";b.onVersionChange(function(a){avril.tools.cache.delByPre(g+a)}),f.queryTemplate=function(b,c){a.ajax({url:b,dataType:"html",success:function(a){c(null,a)},error:function(a){c(a)}})},f.getTemplateUrl=function(a,c){b.onload(function(){var b=avril.request(avril.mvc.config.templateUrl);b.param("path",a),c(b.getUrl())})},f.getViewTemplate=function(c,d){d=d||function(){};var e=c.split("?")[0],h=g+b.version+"-"+(e.split("/").join("-")||"home"),i=function(){return a("#"+h)},j=avril.tools.cache(h),k=function(a,b){f.getTemplateUrl(a,function(a){f.queryTemplate(a,function(a,c){avril.tools.cache(h,a?"":c),b(a,c)})})},l=function(){var b={data:null,template:void 0,templateOk:!1},c=avril.tools.cache(h);if(c){if(i().remove(),0==i().length){var e="script";a("<"+e+' id="'+h+'" type="text/template">'+c+"</"+e+">").hide().appendTo("body")}b.template=h,b.templateOk=!0}d(null,b)};j&&b.release===!0?l():k(e,l)},f.getDataUrl=function(a,b){b(a)},f.events={dataQueryStart:avril.event.get("dataQueryStart",f),dataQuerySuccess:avril.event.get("dataQuerySuccess",f),dataQueryError:avril.event.get("dataQueryError",f)},f.getViewData=function(b,c){f.getDataUrl(b,function(b){var d={url:b};f.events.dataQueryStart([d]),a.ajax({url:b,success:function(a){f.events.dataQuerySuccess([a]),d.data=a,c(d)},error:function(a){f.events.dataQueryError([a]),d.err=a,d.data=null,c(d)}})})},b.ensure(f,"getViewTemplate,getViewData");var h=avril.namespace("avril.mvc.events");h.get=function(a){return function(b,c){avril.event.get(a,h)([b,c])}},h.add=function(a,b){avril.event.get(a,h)(b)},avril.namespace("avril.mvc.routes");var i,j=avril.mvc.routes,k=avril.mvc,l="mvc.pageModel",m="mvc.currentRoute",n=(j.mvcRoute=Backbone.Router.extend({routes:{"*normalPath":"normalPath"},normalPath:function(c){var e=function(){k.request.getViewTemplate("404",function(a){d.model(l)(a)},!1)};d.model(m)(null),k.request.getViewTemplate(c,function(c){c.templateOk?(i=function(){b.defaultLoadData&&k.request.getViewData(Backbone.history.getHash(),function(b){var e=a.extend({},c,b);d.model(l)(e)}),!b.defaultLoadData&&d.model(l)(c)})():e()})}}),j.addRoute=function(c,e,f,g,h){e.indexOf("?")<0&&n(c,e+"?*query",f,g,h);var p,q;return g&&"string"==typeof g&&(q=g,p=!0),h=h||function(){},o.route(e,c,function(g){var j=arguments;d.model(m)({name:c,route:e,viewPath:f}),k.request.getViewTemplate(f,function(c,e){if(void 0===p&&(p=b.defaultLoadData),p){var f=Backbone.history.getHash();if(q){var m=avril.request(q),n=avril.request("?"+g);for(var o in n.queryString)o&&n.param(o)&&m.param(o,n.param(o));f=m.getUrl()}(i=function(){var b=avril.getHash({});i.id=b,k.request.getViewData(f,function(c){if(i&&b!=i.id)return!1;var f=a.extend({},e,c);d.model(l)(f),h.apply(k,j)})})()}else i=void 0,d.model(l)(e),h.apply(k,j)})}),j}),o=(j.addStaticRoute=function(a,b,c,d){return n(a,b,c,d,!1)},j.mvcRoute=new j.mvcRoute);j.onHashChange=avril.event.get("avril.mvc.routes.onhashchange",j),j.getHash=function(){return Backbone.history.getHash()},j.reload=function(){i&&i(new Date)},Backbone.history.bind("all",function(){j.onHashChange([])}),a(function(){Backbone.history.start(),ko.applyBindings(k,document.html)})}(jQuery),function(){avril.namespace("avril.mvc.viewHelper");var viewHelper=avril.mvc.viewHelper,request=avril.mvc.request;ko.bindingHandlers.stopBinding={init:function(){return{controlsDescendantBindings:!0}}},function(){var a="ko-inited";ko.bindingHandlers.oninit={init:function(b,c,d,e){!$(b).data(a)&&c()&&$(b).ready(c()(b,e))&&$(b).data(a,!0)}}}(),function(){ko.bindingHandlers.pop={init:function(a,b){var c=$(a);c.click(function(a){a.preventDefault();var d=ko.utils.unwrapObservable(b())||{};viewHelper.pop(d.url||c.attr("href"),$.extend({title:"..."},d))})}},ko.bindingHandlers.confirm={init:function(a,b){var c=$(a),d=ko.utils.unwrapObservable(b())||{};c.unbind("click").click(function(){avril.confirm(d.msg,d.func)})},update:function(a,b){var c=$(a),d=ko.utils.unwrapObservable(b())||{};c.unbind("click").click(function(){avril.confirm(d.msg,d.func)})}},ko.bindingHandlers.confirmPost={init:function(a,b){var c=$(a),d=ko.utils.unwrapObservable(b())||{};c.unbind("click").click(function(){avril.confirm(d.msg,function(a){a&&$.post(d.url||c.attr("href"),d.func)})})},update:function(a,b){var c=$(a),d=ko.utils.unwrapObservable(b())||{};c.unbind("click").click(function(){avril.confirm(d.msg,function(a){a&&$.post(d.url||c.attr("href"),d.func)})})}},ko.bindingHandlers.alert={init:function(a,b){var c=$(a),d=ko.utils.unwrapObservable(b())||{};c.unbind("click").click(function(){avril.confirm(d.msg,d.func)})},update:function(a,b){var c=$(a),d=ko.utils.unwrapObservable(b())||{};c.unbind("click").click(function(){avril.confirm(d.msg,d.func)})}}}(),function(){ko.bindingHandlers.partial={update:function(a,b,c,d,e){var f=ko.utils.unwrapObservable(b())||{};"string"==typeof f&&(f={view:f});var g=function(b){if(ko.virtualElements.emptyNode(a),f.data)if("object"==typeof f.data){var c=e.createChildContext(f.data,f.as);ko.renderTemplate(b.template||a,c,f,a)}else"string"==typeof f.data&&avril.mvc.request.getViewData(f.data,function(c){var d=e.createChildContext(c,f.as);ko.renderTemplate(b.template||a,d,f,a)});else ko.renderTemplate(b.template||a,e,f,a)};f.view?avril.mvc.request.getViewTemplate(f.view,g):g({})}},ko.virtualElements.allowedBindings.partial=!0}(),viewHelper.modal={paramName:"_modal",getModals:function(a){var b=this,c=avril.request(a);return avril.object(c.queryString).keys().where(function(a){return 0==a.indexOf(b.paramName)}).select(function(a){return{key:a,url:unescape(c.param(a))}})},addToUrl:function(a,b){var c=this.getModals(a),d=c.where(function(a){return a.url==b});if(0==d.length){var e=avril.request(a);return e.param(this.paramName+c.length,escape(b)),e.getUrl()}return a},removeFromUrl:function(a,b){var c=avril.request(a);return this.getModals(a).where(function(a){return a.url==b}).each(function(a){c.param(a.key,null)}),c.getUrl()},getPureUrl:function(a){var b=avril.request(a);return this.getModals(a).each(function(a){b.param(a.key,null)}),b.getUrl()}};var popCache={};viewHelper.pop=function(url,popOptions){if(!url)return!1;if(popCache[url])popCache[url].show();else{var pop=popCache[url]=avril.ui.pop($.extend(!0,{needData:!1,esc:!0},popOptions)),pools=$.extend(avril.mvc.models.getPool(),{rootPools:avril.mvc,pop:pop});pop.show.onShow(function(){var a=avril.mvc.routes.getHash(),b=viewHelper.modal.addToUrl(a,url);Backbone.history.navigate(b,!1)}),pop.hide.onHide(function(){popCache[url]=void 0;var a=avril.mvc.routes.getHash(),b=viewHelper.modal.removeFromUrl(a,url);Backbone.history.navigate(b,!1)}),pop.events.onContentReady(function(){var $configScript=pop.$pop().find('[type="text/config"]');if($configScript.length)try{var config=eval("("+$configScript.text()+")");pop.options(config)}catch(E){}pop.options().needData&&request.getViewData(url||pop.options().dataUrl,function(a){pools.model("dialogModel")(a)}),ko.applyBindings(pools,pop.$pop()[0])}),pop.show(),request.getViewTemplate(url,function(a,b){pop.options("content",$("#"+b.template).html())})}},viewHelper.pop.closeInactive=function(a){avril.object(popCache).keys().each(function(b){if(popCache[b]){var c=a.where(function(a){return a.url==b});0==c.length&&popCache[b].hide()}})},avril.mvc.routes.onHashChange(function(){var a=(Backbone.history.getHash()||"").replace("#",""),b=avril.mvc.viewHelper.modal.getModals(a);b.each(function(a){avril.mvc.viewHelper.pop(a.url)}),avril.mvc.viewHelper.pop.closeInactive(b)})}();