/*version=0.0.17;compress date :Wed, 23 Oct 2013 09:48:51 GMT*/;(function(){function isLambda(a){return a&&typeof a=="string"&&a.indexOf("=>")>0}function arrayEx(a){function c(a){return typeof a=="function"}function d(a){return c(a)?a:isLambda(a)?a.lambda():function(){}}function e(a,b,c){return c=c||1,a.sort(function(a,d){return b?a[b]>d[b]?c:-1*c:a>d?c:-1*c})}var b={};b.asc=function(a){return e(this,a,1)},b.desc=function(a){return e(this,a,-1)},b.each=function(a){a=d(a);for(var b=0;b<this.length;b++)if(a(this[b],b)==0)break;return this},b.where=function(a){a=d(a);var b=[];return this.each(function(c,d){a(c,d)==1&&b.push(c)}),b},b.first=function(a){return a=d(a),this.length==0?null:a?this.where(a)[0]:this[0]},b.last=function(a){return a=d(a),this.length==0?null:c(a)?this.where(a).last():this[this.length-1]},b.groupBy=function(a){a=d(a);if(a){var b={};return this.each(function(c,d){var e=a(c,d)+"";b[e]||(b[e]=[]),b[e].push(c)}),b}return this},b.take=function(a){var b=[];for(var c=0;c<a;c++)b.push(this[c]);return b},b.skip=function(a){var b=[];for(var c=a;c<this.length;c++)b.push(this[c]);return b},b.select=function(a){a=d(a);var b=[];return this.each(function(c,d){b.push(a.call(c,c,d))}),b},b.remove=function(a){a=d(a);var b=[];this.each(function(c,d){a(c,d)&&b.push(d)});var c=this;return b.reverse().each(function(a){c.splice(a,1)}),c},b.removeElement=function(a){return this.remove(function(b,c){return b==a})},b.removeAt=function(a){return this.remove(function(a,b){return b==b})},b.indexOf=function(a){var b=-1;return this.each(function(c,d){if(c==a)return b=d,!1}),b},b.contain=function(a,b){return 1!=b&&typeof a=="function"?this.where(a).length>0:this.indexOf(a)>=0};var c=function(a){return typeof a=="function"};b.distinc=function(a){var b=[];return this.each(function(d,e){c(a)&&a(d,e)!=0?b.push(d):!c(a)&&!b.contain(d)&&b.push(d)}),b},b.clone=function(){var a=[];for(var b=0;b<this.length;b++)a.push(this[b]);return a};for(var f in b)a[f]=a[f]||b[f];return a}String.prototype.toUnicode=function(){return escape(this).replace(/\%/g,"\\")},String.prototype.endWidth=function(a,b){if(b){var c=this.toLower(),d=a.toLower();return c.indexOf(d,c.length-d.length)!==-1}return this.indexOf(a,this.length-a.length)!==-1},String.prototype.beginWidth=function(a,b){if(b){var c=this.toLower(),d=a.toLower();return c.indexOf(d)==0}return this.indexOf(a)==0},String.prototype.replaceAll=function(a,b){var c=new RegExp(a,"gi");return this.replace(c,b)},String.prototype.equals=function(a,b){return b==undefined&&(b=!0),a!=undefined&&a!=null?this==a||this.toLower()==a.toLower():this==a},String.prototype.trim=function(){var a=/(^\s*)|(\s*$)/g;return this.replace(a,"")},String.prototype.trimAll=function(){var a=/\s*/g;return this.replace(a,"")},String.prototype.uperChar0=function(){var a=this,b=a.charAt(0),c=b.toUpperCase();return a.replace(new RegExp("^"+b),c)},String.prototype.lowerChar0=function(){var a=this,b=a.charAt(0),c=b.toLowerCase();return a.replace(new RegExp("^"+b),c)},String.prototype.toLower=String.prototype.toLowerCase,String.prototype.toUpper=String.prototype.toUpperCase,String.prototype.ellipsis=function(a,b){var c=this.toString();if(c.length<=a)return c;b=b||3;var d=c.substr(0,a-b);for(var e=0;e<b;e++)d+=".";return d},String.prototype.lambda=function(ctx){var str=this;if(isLambda(str)){var lambdaKey=str.indexOf("=>"),args=str.substring(0,lambdaKey),funcContent=str.substring(lambdaKey+2),funcStr="function";args.indexOf("(")<0?funcStr+=" ("+args+")":funcStr+=args,funcContent.indexOf("{")>=0?funcContent.indexOf(";")>=0?funcStr+=funcContent:funcStr+="{ return "+funcContent+"; }":funcStr+="{ return "+funcContent+"; }";if(ctx)with(ctx)return eval("("+funcStr+")");return eval("("+funcStr+")")}},arrayEx(Array.prototype)})();(function(a){if(a.avril&&avril.avril)return avril;(function(){var b=a.avril,c={};c.avril="avril",c.$=jQuery;var d=function(a){if(typeof a=="function"||typeof a=="object")a.extend=function(b,e){if(b)if(e)typeof b=="string"&&(a[b]=e);else if(typeof b=="function"||typeof b=="object"){for(var f in b)a[f]=b[f],d(a[f]);b.ready&&typeof b.ready=="function"&&c.ready(function(){b.ready.call(b)})}}};c.isValueType=function(a){return a==null||"number,boolean,string,undefined".split(",").indexOf(typeof a)>=0},c.isFunc=function(a){return typeof a=="function"},c.isObj=function(a){return typeof a=="object"},c.isArray=function(a){return a instanceof Array},c.isStr=function(a){return typeof a=="string"},c.helper={encode:function(a){return $("<div/>").html(a).text()},decode:function(a){return $("<div/>").text(a).html()},encodeReg:function(a){var b="~!@#$%^&*()/\\|[].".split("");return a.split("").select(function(a){return b.indexOf(a)>=0?"\\"+a:a}).join("")}},c.namespace=function(b,c){if(!b||typeof b!="string")throw" typeof(spaceName) must be string!";function e(a,b){if(a.indexOf(".")>0){var c=a.substring(0,a.indexOf("."));b[c]||(b[c]=new Object,d(b[c])),e(a.substring(a.indexOf(".")+1),b[c])}else b[a]||(b[a]=new Object,d(b[a]))}e(b,c||a)},c.module=function(b,d,e){arguments.length==2&&(e=d,d=[]),typeof d=="string"&&(d=d.trimAll().split(","));var f=c.module.getModuleEvent,g=d.where(function(b){return!c.object(a).getVal(b)}),h=0,i=function(h){j();if(h==g.length){c.namespace(b);var i=c.object(a).getVal(b),k=d.select(function(b){return c.object(a).getVal(b)});e.apply(i,k),f(b)([name])}},j=function(){var e=g.where(function(b){return!c.object(a).getVal(b)}),f=d.where(function(b){return!!c.object(a).getVal(b)});e.length==0?console.log(b+" dependences loaded complete."):console.log(b+" dependences loaded "+f.join(",")+", waiting: "+e.join(","))};g.length>0&&g.each(function(a){f(a)(function(){i(++h)})}),i(0)},c.module.getModuleEvent=function(a){return c.event.get("module.events."+a)},c.module.notify=function(a,b){c.module.getModuleEvent(a)([a,b])},c.module.subscribe=function(a,b){c.module.getModuleEvent(a)(b)},c.extend=function(a,b){var a=arguments[0],b=arguments[1];if(a)if(b){if(typeof a=="string")c[a]=b,d(c[a]);else if(typeof a=="object"||typeof a=="function")for(var e in b)a[e]=b[e]}else if(typeof a=="object"||typeof a=="function")for(var e in a)c[e]=a[e],d(c[e]);return c};var e={maxDeep:5,isValueType:function(a){return a==null||"number,boolean,string,undefined".split(",").indexOf(typeof a)>=0},getVal:function(a,b){if(b.indexOf(".")>0){var c=b.substring(0,b.indexOf(".")),d=b.substring(b.indexOf(".")+1);if(!(c.indexOf("[")>=0)){var g=a[c];return this.getVal(g,d)}var e=c.substring(c.indexOf("[")+1,c.lastIndexOf("]"));e=parseInt(e);if(c.indexOf("[")==0)return this.getVal(a[e],d);if(c.indexOf("[")>0){var f=b.substring(0,b.indexOf("["));return f.indexOf('"')==0&&(f=f.substring(1,f.length-2)),this.getVal(a[f][e],d)}}else{if(!(b.indexOf("[")>=0))return a[b];var e=b.substring(b.indexOf("[")+1,b.lastIndexOf("]"));e=parseInt(e);if(b.indexOf("[")==0)return a[e];if(b.indexOf("[")>0){var f=b.substring(0,b.indexOf("["));return a[f][e]}}},setVal:function(a,b,c){if(b.indexOf(".")>0){var d=b.substring(0,b.indexOf(".")),e=b.substring(b.indexOf(".")+1);if(d.indexOf("[")>=0){var f=d.substring(d.indexOf("[")+1,d.indexOf("]"));f=parseInt(f);if(d.indexOf("[")==0)a[f]||(a[f]={}),this.setVal(a[f],e,c);else if(d.indexOf("[")>0){var g=b.substring(0,b.indexOf("["));a[g]||(a[g]=[]),a[g][f]||(a[g][f]={}),this.setVal(a[g][f],e,c)}}else a[d]||(a[d]={}),this.setVal(a[d],e,c)}else{var h=/\[\d*\]/;if(h.test(b)){var f=b.substring(b.indexOf("[")+1,b.lastIndexOf("]"));f=parseInt(f);if(b.indexOf("[")==0)a[f]=c;else if(b.indexOf("[")>0){var g=b.substring(0,b.indexOf("["));a[g]||(a[g]=[]),a[g][f]=c}}else a[b]=c}return a},beautifyNames:function(a,b,d){var e=this;if(c.isArray(a)){var f=[];for(var g=0;g<a.length;g++){var h=a[g];if(c.isObj(h)||c.isArray(h))h=e.beautifyNames(h,b+1,d);f.push(h)}return f}if(c.isObj(a)){var i={};return b=b==undefined||isNaN(b)?0:b,b>this.maxDeep?i:(d==undefined&&(d=!0),this.each(a,function(a,f){e.isValueType(f)?i[a]=f:c.isObj(f)?c.isStr(a)&&d?i[a.lowerChar0()]=c.object.beautifyNames(f,b+1,d):i[a]=c.object.beautifyNames(f,b+1,d):c.isStr(a)&&d?i[a.lowerChar0()]=f:i[a]=f}),i)}},deepClone:function(a,b){return this.beautifyNames(a,b,!1)},each:function(a,b){if(!c.isFunc(b))return!1;if(c.isArray(a)){for(var d=0;d<a.length;d++)if(b(d,a[d])==0)return!1}else for(var e in a)if(b(e,a[e])==0)return!1},keys:function(a){var b=[];return this.each(a,function(a,c){b.push(a)}),b},values:function(a){var b=[];return this.each(a,function(a,c){b.push(c)}),b},tryGetVal:function(a,b){var c=undefined;try{c=this.getVal(a,b)}catch(d){}return c},instanceOf:function(a,b){return a instanceof b},keyValues:function(a){var b=[];return this.each(a,function(a,c){b.push({key:a,value:c})}),b},toArray:function(a){var b=[];if(a.length)for(var c=0;c<a.length;c++)b.push(a[c]);return b}};c.object=function(a){var b={getVal:function(b){return c.object.getVal(a,b)},setVal:function(b,d){return c.object.setVal(a,b,d)},each:function(b){c.object.each(a,b)},keys:function(){return c.object.keys(a)},values:function(){return c.object.values(a)},beautifyNames:function(){return c.object.beautifyNames(a)},deepClone:function(b){return c.object.deepClone(a,b)},tryGetVal:function(b){var d=undefined;try{d=c.object.getVal(a,b)}catch(e){}return d},instanceOf:function(b){return c.object.instanceOf(a,b)},keyValues:function(){return c.object.keyValues(a)},toArray:function(){return c.object.toArray(a)}};return b},$.extend(c.object,e);var f={};c.data=function(a,b){typeof a!="string"&&(a=c.getHash(a).toLowerCase());if(arguments.length==1){try{var d=c.object.getVal(f,a);return d}catch(e){}return null}if(arguments.length==2)c.object.setVal(f,a,b);else if(arguments.length==0)return f},c.guid=function(){return(new Date).getTime()+"_"+Math.random().toString().replace(".","_")},c.alert=function(a){alert(a)},c.confirm=function(a,b,c){a==undefined||a==""?b(!0):b(confirm(a))};var g=[],h=function(a){var b=g.first(function(b){return b.obj==a});return b||(b={obj:a,key:c.guid()},g.push(b)),b.key};c.getHash=h;var i=!1;c._single=function(){i||(c.getHash=top.avril?top.avril.getHash:h),i=!0},a.avril=c})(),function(b,c){function h(a,b){var b=b||e+"["+f+"].",c=b+a;return d._event[c]||d.register(c),d._event[c]}function i(a,b,c){var d=d||"before",e=e||"on",f=a,i=f[b],j=g(d,b),k=g(e,b);if(typeof f[b]!="function"||typeof f[b][j]=="function"||typeof f[b][k]=="function")return f;var l=h(j,c),m=h(k,c);return f[b]=function(){var a=this;if(l(a,arguments)){var b=i.apply(a,arguments),c=[];c.push(b);for(var d=0;d<arguments.length;d++)c.push(arguments[d]);return m(a,c),b}return!1},f[b]._orgFunc=i,f[b][j]=l,f[b][k]=m,f}if(c.event)return!0;var d=c.event={},e=c.guid(),f=0,g=function(){var a=[];if(!arguments.length)return"";for(var b=0;b<arguments.length;b++)a.push(arguments[b]);a[0]&&(a[0]=a[0].lowerChar0());for(var b=1;b<arguments.length;b++)a[b]=a[b].uperChar0();return a.join("")};d._event={eventList:{},add:function(a,b,c,d){b=b||"default",this.eventList[b]||(this.eventList[b]=[]);var e={func:a,data:c};this.eventList[b].push(e)},execute:function(a,b,d){a=a||"default",this.eventList[a]=this.eventList[a]||[],b=b||c.event._event;var e=!0;return this.eventList[a].each(function(a){if(d&&d.length>=0){var c=[];for(var f=0;f<d.length;f++)c.push(d[f]);a.data&&c.push(a.data),e=e&&a.func.apply(b,c)!=0}else e=e&&a.func.call(b,d,a.data)!=0}),e},clear:function(a){this.eventList[a]=[]}},d.events=d._event.eventList,d.register=function(a,b){if(d._event[a])return d._event[a];var e=function(d,e){if(typeof d!="function")return e=e||d,b=b||e,c.event._event.execute(a,b,e);c.event._event.add(d,a,e,b)};return e.clear=function(){d._event.clear(a)},e.eventList=function(){return d._event.eventList[a]},e.execList=function(){},d._event[a]=e,e},d.registerOn=function(a,b,d){var e=c.getHash(a)+"_"+b;return this.register(e,d)},d.remove=function(a){d._event[a]&&delete d._event[a]},d.clear=function(a){d._event.clear(a)},d.hook=function(a,b,d){d=d||c.getHash(a),b.split(",").each(function(b){b&&i(a,b,d)})},d.unhook=function(a,b){a[b]&&a[b]._orgFunc&&(a[b]=a[b]._orgFunc)},d.get=function(b,c){c||(c=a);if(c.jquery)return c.each(function(){d.registerOn(this,b,this,this)}),function(){var a=arguments,e=!0;return c.each(function(){e=e&&d.registerOn(this,b,this,this).apply(this,a)}),e};var e=this.registerOn(c,b,c,c);return e}}(avril.$,avril),function(b){if(b.createlib)return b.createlib;var c={uperChar0:function(a){var b=a.charAt(0),c=b.toUpperCase();return a.replace(new RegExp("^"+b),c)},lowerChar0:function(a){var b=a.charAt(0),c=b.toLowerCase();return a.replace(new RegExp("^"+b),c)}},d=0,e=function(){var a=[];if(!arguments.length)return"";for(var b=0;b<arguments.length;b++)a.push(arguments[b]);a[0]&&(a[0]=c.lowerChar0(a[0]));for(var b=1;b<arguments.length;b++)a[b]=c.uperChar0(a[b]);return a.join("")},f={},g=function(c,g,h,i,j){j=j||a;if(b.object(j).tryGetVal(c))return b.object(j).tryGetVal(c);b.object(j).setVal(c,function(a){function t(a,b){if(!a)return!1;var c=b.events;for(var d in a)c[d]&&typeof a[d]=="function"&&(a.clearAllEvents==1&&c[d].clear(),c[d](a[d]))}d++;var h=b.object(j).getVal(c);if(!(this instanceof h))return new h(a);var k=this;if(i){b.isStr(i)&&(i=b.object(j).getVal(i));var l=i(a);b.object(l).each(function(a,b){k[a]=b}),k._getSuper=function(){return l}}else{k._getSuper=function(){return null},k.events={};var m=b.guid(),n=f[m]={},o=b.event.register(c+"["+d+"].onPropertyChange"),p=b.event.register(c+"["+d+"].beforePropertyChange");t(a,k);function q(a,e){var f=e.events,g=c+"["+d+"].";f[a]||(f[a]=b.event.register(g+a,f))}function r(a,b,c){var d=b[a],e=c[a];if(d!=e){var f=p([a,b,c]);f&&(c[a]=b[a],o([a,b,c]))}}k.options=function(a,b){if(arguments.length>0){if(typeof a=="object")for(var c in a)r(c,a,n);else if(typeof a=="string"){var c=a,a={};a[c]=b,r(c,a,n)}return t(a,this),this}return n},k.events.beforeOptionChange=p,k.events.onOptionChange=o;function s(a,f){b.event.hook(a,f,c+"["+d+"].");var g=g||"before",h=h||"on",i=e(g,f),j=e(h,f);return a.events[i]=a[f][i],a.events[j]=a[f][j],a}k.hook=function(a){var b=this;return typeof a=="string"&&(a.indexOf(",")>=0?a.split(",").each(function(a){s(b,a)}):s(b,a)),b},k._prop=function(a,c,d){b.createlib.getset(k,a,c,d)},k._parseConfig=function(a){b.createlib.parseConfig(k,a)}}typeof g=="function"&&(g.call(this,a),t(a,this))});var k=b.object(j).getVal(c),l;$.extend(k,h);var m=k.toString;return k.toString=function(a){return a?m.call(k):"type [ "+c+" ] "},k.toJQ=function(a,b){var c=a;a+="API",$.fn[c]=function(c){var d=arguments,e=this.each(function(){var d=$(this);if(!d.data(a)){var e={};typeof b=="function"?b.call(d,e):typeof b=="string"&&(e[b]=d);var f=new k($.extend({},c,e));d.data(a,f),typeof f.init=="function"&&f.init()}else var f=d.data(a)});if(this.length!=0&&this.data(a)){var f=this.data(a);if(d.length==1){if(typeof d[0]=="string")return f[d[0]]}else if(d.length>1&&typeof d[0]=="string"&&f[d[0]]){if(typeof f[d[0]]=="function"){var g=[];for(var h=1;h<d.length;h++)g.push(d[h]);return f[d[0]].apply(f,g)}f[d[0]]}}return this}},fnName=c.replace(new RegExp("\\.","gi"),"_"),$.fn[fnName]||($.fn[fnName]=function(a){return this.each(function(){var b=$(this),d=$.extend({$:b},a),e=k(d);b.data(c,e)}),this}),k},h=function(a,c,d,e,f){var g=b.createlib(c,d,e,a,f);return g};b.createlib=g,b.createlib.getset=function(a,c,d,e){a[c]=function(a,c,d,e){var f={value:undefined};return function(){return arguments.length==0?b.isFunc(d)?d.call(f,f.value):f.value:(b.isFunc(e)?e.call(f,arguments[0]):f.value=arguments[0],a)}}(a,c,d,e)},b.createlib.parseConfig=function(a,c){b.object(a.options()).each(function(d,e){if(d.indexOf("$")==0&&!a[d]){var f,g=b.guid();b.createlib.getset(a,d,function(){return g!=a.options()[d]&&(g=a.options()[d],f=(c||$)(a.options()[d])),f},function(b){a.options(d,b)})}})},b.createlibOn=function(a,c,d,e,f){return b.createlib(c,d,e,f,a)},b.extendlib=h,b.createlib.beautifyFunName=e,function(){var a=b.object.instanceOf;b.object.instanceOf=function(a,c){var d=a instanceof c;if(d)return!0;if(b.isFunc(a._getSuper)){var e=a._getSuper();d=e instanceof c;if(d)return!0;if(e!=null)return b.object(e).instanceOf(c)}return d}}()}(avril),a.console||(a.console={},a.console.log=function(){})})(this);(function(a){String.prototype.localize=function(){return $(a.ui.helper.$span().html(this.toString()).localize())[0].outerHTML},a.toArray=function(a){var b=[];if(a.length)for(var c=0;c<a.length;c++)b.push(a[c]);return b}})(avril),avril.namespace("avril.ui"),function(a){var b="localizeKey";$.fn.localize=function(c){var d=this;return this.data(b,this.data(b)||this.html()),this.attr("data-localize","false"),c&&this.attr("data-loaclize-group",c),a.tools.localize.parse(d),this};var c=a.ui.helper={divStr:"<div/>",linkStr:"<a/>",tagBuilder:function(a,b){var c=$(this.tagStr[a]);return b&&c.attr(b),c},localize:{},tagStr:{}},d="a,abbr,acronym,address,applet,area,b,base,basefont,bdo,big,blockquote,body,br,button,canvas,caption,center,cite,code,col,colgroup,dd,del,dfn,dir,div,dl,dt,em,fieldset,font,form,frame,frameset,h1,h2,h3,h4,h5,h6,head,hr,html,i,iframe,img,input,ins,isindex,kbd,label,legend,li,link,map,menu,meta,noframes,noscript,object,ol,optgroup,option,p,param,pre,q,s,samp,script,select,small,span,strike,strong,style,sub,sup,table,tbody,td,textarea,tfoot,th,thead,title,tr,tt,u,ul,var";d.split(",").each(function(a){var b="$"+a;c.tagStr[a]="<"+a+"/>",c[b]=function(b){return c.tagBuilder(a,b)},c.localize[b]=function(a,d){var e=c[b].apply(c,arguments);return e.localize(d),e}}),function(){var b=c.$a;c.$a=function(a){if(!a||!a.href)a=a||{},a.href="javascript:;";b.call(c,a)}}()}(avril),function(a,b){b.createlib("avril.ui.msg",function(c){function g(a,b){a.show(),a.removeClass("alert-success alert-error alert-info").addClass("alert-"+b.type),a.find("strong").html(b.title),a.find("span").html(b.msg)}var d=a.extend(!0,this.options(),{$container:"body"},c),e=function(){f=a('<div class="alert" style="display:none;"> <button type="button" class="close" data-dismiss="alert">×</button> <strong/>:  <span/>  </div>').attr("guid",b.guid()),f.find("button").click(function(){f.fadeOut()})},f;this._parseConfig(),this.show=function(a,b){return arguments.length==1?(b=arguments[0],a=this.$container()):arguments.length==2&&(d.$container=a),a.children("div.alert").length==0?(e(),f.prependTo(a)):f=a.find("div.alert"),g(f,b),this},this.showInBody=function(a){return d.$container="body",this.show("body",a),this}})}(jQuery,avril),function($,avril){function initDialog(a){if(a.options().buttons){var b=a,c=a.options(),d=function(){var b=a.$pop().find(".modal-footer");return b.length||(a.$pop().find(".modal-body").after($('<div class="modal-footer"></div>')),b=a.$pop().find(".modal-footer")),b};a.onButtonClick=avril.event.get("onButtonClick",a);if(c.buttons){var e=d();e.html(""),c.buttons.each(function(a){var c=a,d=a,f="btn";typeof a=="object"&&(c=a.name,d=a.text,f=a.cls=a.cls||"btn",typeof a.fun=="function"&&b.onButtonClick(function(b,d){b==c&&a.fun(b,d)})),$('<a href="javascript:;"/>').addClass(f).html(d).localize().click(function(){b.onButtonClick([c,$(this)])}).appendTo(e)})}a.$pop().find(".modal").css("min-height","none")}}var popList=[],_divStr='<div style="display:none;"><div class="modal-backdrop fade in"></div>                  <div class="modal">                   <div class="modal-header">                     <button type="button" class="close">×</button>                     <h3>Untitle</h3>                   </div>                   <div class="modal-body">                                       </div>                 </div></div>';avril.createlib("avril.ui.pop",function(a){var b=$.extend(this.options(),{autoSize:!0,$handle:null,draggable:!0,resizable:!0,effect:"puff",effectTime:450,easing:"easeInExpo",title:""},a),c=!1,d=this,e=function(){return d.$pop().find(".modal")},f=function(){return e().find(".modal-body")},g=function(){return e().find(".modal-header")};this._parseConfig($),this.$modal=e,this.$body=f,this.$header=g,this.$pop=function(a){return a&&(this._$pop=a),$(this._$pop)},this.init=function(){if(!this._inited){var a=this.$pop($(_divStr).appendTo("body"));h(this.$handle()),i(),j(),k(b.width,b.height),l(b.title),d.events.onLoadHandle(function(){f().find(".close,.close-pop,button[type=reset]").click(function(){d.hide()}),k(b.width,b.height)}),this._inited=!0}return this},this.load=function(a,b){function c(a){if(d.events.onLoad([a])){d.$pop().find("div.modal-body").html(a);var c=d.$pop().find(".modal-body h3:eq(0)").hide();d.$pop().find(".modal-header h3:eq(0)").html(c.html()),d.events.onLoadHandle([d.$pop(),d]),d.events.onContentReady([]),b&&b()}}this.events.beforeLoad([d])&&$.ajax({url:a,success:c,error:function(){d.hide()}})},this.show=function(){popList.push(this),this.init(),this.$pop().show(),this.$pop().find(".modal-backdrop").css("z-index",avril.ui.getZindex()+2).css("opacity",.6),this.$pop().find(".modal").hide().show(b.effect,{to:d.$handle(),easing:b.easing},b.effectTime,function(){d.$pop().find(".modal-backdrop").css("z-index",avril.ui.getZindex()+1),d.$pop().find(".modal").css("z-index",avril.ui.getZindex()+1)}),this.$pop().find(".close,.close-pop,button[type=reset]").click(function(){d.hide()})},this.hide=function(){popList.remove(function(a){return a==d}),this._inited=!1,this.$pop().find(".modal").hide(b.effect,{to:d.$handle(),easing:b.easing},b.effectTime,function(){d.$pop().remove()})},this.disable=function(){c=!0};var h=function(a){if(a&&a.length){var c=a.attr("href"),e=!1;c.indexOf("#")>0&&(b.$pop=c.substring(c.indexOf("#")),e=!0),a.click(function(a){a.preventDefault(),e||d.load($(this).attr("href")),d.show()})}},i=function(){d.$pop().find(".modal").draggable({handle:".modal-header h3"}),b.draggable||(d.$pop().find(".modal").draggable("disable"),d.$pop().find(".modal").removeClass("ui-state-disabled"))},j=function(){d.$pop().find(".modal").resizable(),b.resizable||(d.$pop().find(".modal").resizable("disable"),d.$pop().find(".modal").removeClass("ui-state-disabled"))},k=function(a,b){a!==undefined&&e().width(a),b!==undefined&&e().height(b)},l=function(a){return g().find("h3").html(a)},m=function(){var a=d.$pop().find(".modal"),b=$(window).height(),c=$(window).width(),e=a.width(),f=a.height(),g=0,h=0;b>f&&(g=(b-f)/2),a.css({position:"absolute",top:g+"px"})};this.makePositionCenter=m,d.hook("show,hide"),this.events.beforeLoad=avril.event.get("beforeLoad",this),this.events.onLoad=avril.event.get("onLoad",this),this.events.onLoadHandle=avril.event.get("onLoadHandle",this),this.events.onContentReady=avril.event.get("onContentReady",this),this.events.onHide=avril.event.get("onHide",this),this.events.onOptionChange(function(a,b,c){switch(a){case"content":d.$pop().find(".modal-body").html(b[a]),avril.tools.localize.parse(d.$pop()),d.events.onLoadHandle([d.$pop(),d]),d.events.onContentReady([]);break;case"title":l(b[a]);break;case"width":k(b[a]);break;case"height":k(undefined,b[a]);break;case"draggable":i();break;case"resizable":j()}}),this.show.onShow(function(){setTimeout(m,500)}),$(window).resize(m)}),avril.alert=function(a,b){b=b||function(){};var c=avril.ui.pop({width:300,height:200,resizable:!1,alert:"Alert",title:"Alert",buttons:[{text:"OK",name:"OK",cls:"btn btn-primary"}],showFooter:!0}).init();c.$header().find("h3").localize(),initDialog(c),c.options("content",a).show(),c.onButtonClick(function(a,d){b(),c.hide()}),c.$pop().find("a:eq(0)").focus()},avril.confirm=function(a,b){b=b||function(){};var c=avril.ui.pop({width:320,height:180,resizable:!1,title:"Confirm",buttons:[{text:"Confirm",name:"Confirm",cls:"btn btn-primary"},{text:"Cancel",name:"Cancel",cls:"btn btn-danger"}],showFooter:!0}).init();c.$header().find("h3").localize(),initDialog(c),c.options("content",a).show(),c.onButtonClick(function(a,d){switch(a){case"Confirm":b(!0),c.hide();break;case"Cancel":b(!1),c.hide()}}),c.$pop().find("a:eq(0)").focus()},avril.prompt=function(a,b,c){function e(){var a=b(d.$body().find("input").val())!==!1;a&&d.hide()}b=b||function(){};var d=avril.ui.pop({width:320,height:180,resizable:!1,title:"Prompt",buttons:[{text:"Ok",name:"Ok",cls:"btn btn-primary"},{text:"Cancel",name:"Cancel",cls:"btn btn-danger"}],showFooter:!0}).init();d.$header().find("h3").localize(),initDialog(d),d.options("content",a+'<br/><br/><input class="input-xxlarge" value="'+(c||"")+'" /> ').show(),d.$pop().find("input").keyup(function(a){a.keyCode==13&&e()}),d.onButtonClick(function(a,b){switch(a){case"Ok":e();break;case"Cancel":d.hide(!1)}})},avril.ui.pop.open=function(a){var b=new avril.ui.pop;b.load(a),b.show()},avril.ui.pop.toJQ("pop",function(options){if(this.attr("data-pop"))try{$.extend(!0,options,eval("("+this.attr("data-pop")+")"))}catch(E){}options.$handle=this}),avril.ui.popContext={popList:function(){return popList},getCurrent:function(){return popList&&popList.length?popList[popList.length-1]:null}}}(jQuery,avril),function(avril){avril.namespace("avril.ui"),avril.ui.cookie={get:function(a){var b=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)"));return b!=null?unescape(b[2]):null},set:function(a,b,c){c=c||30;var d=new Date;d.setTime(d.getTime()+c*24*60*60*1e3),document.cookie=a+"="+escape(b)+";expires="+d.toGMTString()},del:function(a){var b=new Date;b.setTime(b.getTime()-1);var c=this.get(a);c!=null&&(document.cookie=a+"="+c+";expires="+b.toGMTString())},getObj:function(key){return window.JSON?window.JSON(this.get(key)):eval("("+this.get(key)+")")},setObj:function(a,b){this.set(a,window.JSON?window.JSON.stringify(b):$.toJSON(b))}}}(avril),function(a,b){b.createlib("avril.ui.progressbar",function(c){function i(){j(),d.stop=!1;var a=0;h=setInterval(function(){a++==100&&(a=0),d.stop||(e.progressbar("value",a),e.css("z-index",b.ui.getZindex()+2))},50)}function j(){d.stop=!0;try{clearInterval(h)}catch(a){}}var d=a.extend(!0,this.options(),{auto:!0,stop:!1},c),e=b.ui.helper.$div().css({width:d.width||250,height:d.height||20,position:d.position||"fixed",bottom:d.bottom||0,right:d.right||0,display:"none"}).appendTo("body"),f=this,g=b.guid(),h;e.progressbar(),d.auto&&i(),this.show=function(){return e.show(),i(),this},this.hide=function(){return e.hide(),j(),this},this.$el=e},{bottom_right:function(){var a;return function(){return a||(a=b.ui.progressbar()),a}}()})}(jQuery,avril),function($,avril){(function(a,b,c){function j(a){return a=a||location.href,"#"+a.replace(/^[^#]*#?(.*)$/,"$1")}"$:nomunge";var d="hashchange",e=document,f,g=a.event.special,h=e.documentMode,i="on"+d in b&&(h===c||h>7);a.fn[d]=function(a){return a?this.bind(d,a):this.trigger(d)},a.fn[d].delay=50,g[d]=a.extend(g[d],{setup:function(){if(i)return!1;a(f.start)},teardown:function(){if(i)return!1;a(f.stop)}}),f=function(){function n(){var c=j(),e=m(h);c!==h?(l(h=c,e),a(b).trigger(d)):e!==h&&(location.href=location.href.replace(/#.*/,"")+e),g=setTimeout(n,a.fn[d].delay)}var f={},g,h=j(),k=function(a){return a},l=k,m=k;return f.start=function(){g||n()},f.stop=function(){g&&clearTimeout(g),g=c},a.browser.msie&&!i&&function(){var b,c;f.start=function(){b||(c=a.fn[d].src,c=c&&c+j(),b=a('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){c||l(j()),n()}).attr("src",c||"javascript:0").insertAfter("body")[0].contentWindow,e.onpropertychange=function(){try{event.propertyName==="title"&&(b.document.title=e.title)}catch(a){}})},f.stop=k,m=function(){return j(b.location.href)},l=function(c,f){var g=b.document,h=a.fn[d].domain;c!==f&&(g.title=e.title,g.open(),h&&g.write('<script>document.domain="'+h+'"</script>'),g.close(),b.location.hash=c)}}(),f}()})(jQuery,this),avril.createlib("avril.ui.ajaxframe",function(options){function _isAjaxHash(){var a=window.location.hash;return a.indexOf(config.identifyPre)==0?!0:!1}function _getUrl(){return window.location.hash.substring(1)}function _getCache(a){return cache[a||_getUrl()]}function setContent(a,b){b!=0?self.$container().hide(config.hideEffect||config.effect,function(){self.$container().html(a),self.onLoad([self,self.$container()]),self.$container().show(config.showEffect||config.effect)}):(self.$container().html(a),self.onLoad([self,self.$container()]))}function loadContent(url,hasEffect){self._lasturl=url,!_getCache(url)||!config.cache?$.ajax({url:url,data:{_avril_guid:avril.guid()},success:function(response){var isJSON=!1,obj;try{var json=$("<div/>").html(response).text();obj=eval("("+json+")"),isJSON=!0}catch(E){}isJSON?response.innerType?avril[response.innerType](response.msg,function(){avril.event.get("response."+response.innerType)(avril.toArray(arguments).push(url))}):avril.ui.msg().show("body>div.container.main-page",obj):(cache[url]=response,setContent(response,hasEffect))}}):config.cache&&_getUrl(url)&&setContent(_getCache(url))}var config=$.extend(this.options(),{identifyPre:"#/",$container:"#ajax-container",showEffect:"slide",hideEffect:"slide",enabled:!0,cache:!1},options),self=this,_firstContent,cache={},triggerChange=!0;this._parseConfig(),this.loadContent=loadContent,this.onLoad=avril.event.get("onLoad",this),this.reload=function(){return self._lasturl&&this.loadContent(self._lasturl,!1),this},this.beforeLoad=avril.event.get("beforeLoad",this),this.navTo=function(a){this.options().enabled&&(window.location="#"+a,triggerChange=!1,this.loadContent(a))},this.parseLink=function(a){$(a).each(function(){!$(this).data("ajaxframe-parse")&&!$(this).is(".no-ajax")&&($(this).click(function(a){self.options().enabled&&(a.preventDefault(),self.navTo($(this).attr("href")))}),$(this).data("ajaxframe-parse",!0))})},this.init=function(){_firstContent=this.$container().html(),$(window).hashchange(function(){self.options().enabled&&(triggerChange&&_isAjaxHash()?self.loadContent(_getUrl()):triggerChange&&!window.location.hash&&setContent(_firstContent)),triggerChange=!0}),_isAjaxHash()&&self.options().enabled&&self.loadContent(_getUrl(),!1),this.parseLink("a.ajaxlink")},this.getUrl=function(){return _getUrl()}}),window.ajaxFrame=avril.ui.ajaxframe()}(jQuery,avril),function(){avril.ui.getZindex=function(){return $("*").toArray().select(function(a){var b=$(a).css("z-index");return b&&!isNaN(b)?parseInt(b):0}).sort().pop()}}(),function(a){function b(b){var c=a(this);if(!c.data("loadingCover")){var d="<div/>",e=a(d).css({position:"absolute"}).addClass("loading-cover"),f=a(d).addClass("mask").appendTo(e),g=a(d).addClass("loading-img").appendTo(e),h=function(){var b=a(window),c=b.height(),d=b.width();g.css({top:"50%",position:"fixed"})},i=function(){e.css({width:c.width(),height:c.height(),top:c.offset().top,left:c.offset().left,"z-index":avril.ui.getZindex()+1}),g.css({left:c.width()/2-16,top:c.height()/2-16})},j={adjust:i,remove:function(){e.remove(),c.data("loadingCover",null)},hide:function(){e.hide()},show:function(){i(),e.show()},cover:function(){return e}};avril.ui.loadingCover.removeAll(j.remove),avril.ui.loadingCover.hideAll(j.hide),e.appendTo("body"),i(),a(window).resize(function(){i()}),c.is("body")&&h(),c.data("loadingCover",j)}else c.data("loadingCover").show()}avril.namespace("avril.ui.loadingCover"),avril.ui.loadingCover.removeAll=avril.event.register("avril.ui.loadingCover.removeAll"),avril.ui.loadingCover.hideAll=avril.event.register("avril.ui.loadingCover.hideAll"),a.fn.loadingCover=function(a){return this.each(function(){b.call(this,a)}),this},a(function(){a("body").loadingCover(),avril.ui.loadingCover.hideAll()})}(jQuery),avril.module.notify("avril.ui");(function($,avril){avril.namespace("avril.tools");var _cache={};(function(a){if(a.request)return!1;a.request=function(){function c(c){var d={};if(b[c])return b[c];d.queryString=function(){if(c.indexOf("?")<0)return{};var a={},b,d=function(a){return decodeURIComponent(a.replace(/\+/g," "))},e=c.substring(c.indexOf("?")+1),f=/([^&=]+)=?([^&]*)/g;while(b=f.exec(e))a[d(b[1])]=d(b[2]);return a}();var e=function(b,c){var e=!1;return a.object(d.queryString).each(function(a,f){b.toLower()==a.toLower()&&(e=!0,d.queryString[a]=c)}),e||(d.queryString[b]=c),d},f=function(b){var c;return a.object(d.queryString).each(function(a,d){b.toLower()==a.toLower()&&(c=d)}),c};return d.param=function(a,b){if(arguments.length==0)return this;if(arguments.length==1)return f(a);if(arguments.length==2)return e(a,b)},d.getUrl=function(){var a=c.split("?")[0];for(var b in d.queryString)a.indexOf("?")<0&&(a+="?"),d.queryString[b]!=null&&(a+=b+"="+d.queryString[b]+"&");return a.lastIndexOf("&")==a.length-1?a.substring(0,a.lastIndexOf("&")):a},b[c]=d,d}var b={};return $.extend(c,c(window.location.href)),c}()})(avril),avril.namespace("avril.tools.loader"),avril.tools.loader.extend({jsonp:function(options){function removeScript(){function a(){try{(head?head[0]:document).removeChild(script)}catch(a){}try{delete window[jsonpcallback]}catch(a){}}typeof script.jsonp=="undefined"&&options.error(),setTimeout(function(){a()},5e3)}options.success=options.success||function(){},options.error=options.error||function(){};var jsonpcallback="avril_"+avril.guid();window[jsonpcallback]=function(){script.jsonp=!0;if(options.success){var obj=arguments[0];typeof obj=="string"&&(obj=eval("("+obj+")")),options.success(obj)}};var script=document.createElement("script");script.type="text/javascript",script.language="javascript",script.charset="utf-8",script.async=!0;var head=document.getElementsByTagName("head");head[0].appendChild(script),script.onload=script.onreadystatechange=function(){(-[1]||/loaded|complete/i.test(this.readyState))&&removeScript()},script.onerror=function(){removeScript()};var request=avril.request(options.url);options.data&&avril.object(options.data).each(function(a,b){typeof b!="function"&&typeof b!="object"&&request.param(a,encodeURIComponent(b))}),request.param(options.jsonp||"jsonpcallback",jsonpcallback),script.src=request.getUrl()},json:function(a){a.url&&a.url.indexOf("http")==0&&a.url.indexOf("http://"+document.location.host)<0&&a.url.indexOf("https://"+document.location.host)<0?this.jsonp(a):$.ajax(a)},loadScript:function(a,b){callbackCache.hasOwnProperty(a)?b():(loadingList.push(a),callbackCache[a]=b||function(){},loadingList.length==1&&this._loadScript())},loadStyle:function(a){var b=document.getElementsByTagName("head")||document.getElementById("body"),c=document.createElement("link");c.rel="Stylesheet",c.type="text/css",(b?b[0]:document).appendChild(c),c.href=a},template:function(a,b){var c=avril.tools.cache(a);c?b(cache):$.get(a,function(c){b(c),avril.tools.cache(a,c)})}}),avril.createlib("avril.tools.Communicator",function(a){var b=$.extend(this.options(),{targetWindow:window},a),c=this,d=avril.event.registerOn(this,"init",this,this),e=_cache._cacheData={},f=[];d(function(){if(window.postMessage)window.addEventListener?window.addEventListener("message",function(a){h([$.parseJSON(a.data).data])},!1):window.attachEvent&&window.attachEvent("onmessage",function(a){h([$.parseJSON(a.data).data])});else{var a="";setInterval(function(){window.name!==a&&(a=window.name,h([$.parseJSON(a).data]))},1)}}),this.targetWindow=b.targetWindow,this.init=function(a){return a&&this.options(a),d([this]),this};var g=function(a,c){var d=avril.guid()+"_guid",f=a;a.guid=d,a.needFeedback=!!c,a=$.toJSON({data:a,guid:d}),e[d]=[];var g=0;(function h(){b.targetWindow.postMessage?b.targetWindow.postMessage(a,"*"):function(){b.targetWindow.name=a}(),c&&g++<1e4&&e[d].push(setTimeout(h,500+g))})()},h=avril.event.registerOn(this,"onMessage",this,this),i=this.onFeedback=avril.event.registerOn(this,"onFeedback",this,this),j=this.commandType={im:"im",command:"command",feedback:"feedback",message:"message"};this.postCommand=function(a){arguments.length==2&&(a={name:arguments[0],data:arguments[1]}),g({type:j.command,data:a},!0)},this.onCommand=avril.event.registerOn(this,"onCommand",this,this),this.postIM=function(a){g({type:j.im,data:a},!0)},this.onIM=avril.event.registerOn(this,"onIM",this,this),h(function(a){if(f.contain(a.guid))return!1;var b=!0;switch(a.type){case j.command:b=c.onCommand([a.data]);break;case j.im:b=c.onIM([a.data]);break;case j.feedback:b=i([a.data])}b&&(f.push(a.guid),a.needFeedback&&g({type:j.feedback,data:a.guid}))}),i(function(a){_cache._cacheData[a]&&_cache._cacheData[a].each(function(a){try{clearTimeout(a)}catch(b){}})}),this.events.onOptionChange(function(a,b,d){a=="targetWindow"&&(c.targetWindow=b.targetWindow)})}),avril.tools.Communicator.current=avril.tools.Communicator(),avril.tools.cache=function(){var a=window.localStorage||{},b=function(b,c){switch(arguments.length){case 0:return a;case 1:return a[b];case 2:return a[b]=c}};return b.del=function(b){delete a[b]},b.delByPre=function(c){for(var d in a)d.indexOf(c)==0&&b.del(d)},b.list=function(a,c){function d(c){return c.save=function(){b.list(a,c)},c}switch(arguments.length){case 1:var e=[];if(b(a)){var c=$.parseJSON(b(a)).data;return d(c),c}return d(e);case 2:if(c instanceof Array)return b(a,$.toJSON({data:c})),d(c);var e=[c];return b(a,$.toJSON({data:e})),d(e)}},b.object=function(a,c){function d(c){return c=c||{},c.save=function(){return b.object(a,c),c},c}switch(arguments.length){case 1:return c=b(a),c?d($.parseJSON(c).data):d();case 2:return b(a,$.toJSON({data:c})),d(c)}},b.localStorage=!!window.localStorage,b}(),function(){avril.createlib("avril.tools.Localize",function(a){var b=$.extend(this.options(),{url:"/resources/localize",datatype:"jsonp",version:"0.1",language:"default",type:"post"},a);this.parse=function(a,c){var d=$(a).is("[data-localize]")?$(a):$(c?"[data-localize]":"[data-localize][data-localize!=true]",a||"body"),e=avril.tools.cache.list(b.language),f=[],g=[],h=function(a){return e.first(function(b){return b.key==a})};d.each(function(){var a=$(this);if(a.is("[data-localize]")){var b=h(a.html());b==null?(f.push(a.html()),g.push(a)):a.html(b.text)}}),f.length>0&&$.ajax($.extend({data:{data:f},success:function(a){a.each(function(a,b){a=unescape(a),g[b].html(a).attr("localize","true");var c=e.first(function(a){return a.key==f[b]});c==null?e.push({key:f[b],text:a}):c.text=a}),e.save()}},b))}}),avril.tools.localize=avril.tools.Localize()}(),avril.createlib("avril.tools.sql",function(a){function d(){c.db=openDatabase("mydb","1.0","Test DB",2097152)}function e(){}var b=$.extend(!0,this.options(),{dbName:null},a),c=this;this.collection=function(a,b){}}),function(a){if(!a.tmpl)return!1;a.extend(jQuery.tmpl.tag,{"for":{_default:{$2:"var i=0;i<0;i++"},open:"for ($2){",close:"};"}}),avril.tools.template={render:function(b,c){b=a(b);var d="data-tmpl",e=b.attr(d);e?b.html(a.tmpl(e,c)):(e=avril.guid(),b.attr(d,e),a.template(e,b.html()),b.html(a.tmpl(e,c)))},parse:function(b){b=b?a(b):a("body"),b.find('[type="text/x-jquery-tmpl"]').each(function(){var b=a(this),c=b.attr("name");a.template(c,b.html()),b.remove()})}}}(jQuery)})($,avril);(function(a){avril.namespace("avril.mvc.config");var b="/resources/config",c=avril.mvc.config;a.extend(c,{templateUrl:"/resources/template",release:!1,configUrl:b}),c.load=function(b){var d=function(b){a.extend(avril.mvc.config,b)},e=function(a){a=a||{},a.requestReady=!0,d(a),avril.mvc.config.onload([avril.mvc.config])};typeof b=="string"?(c.configUrl=b,a.getJSON(b.configUrl,e)):b&&typeof b=="object"?(d(b),b.configUrl?a.getJSON(b.configUrl,e):e(b)):a.getJSON(c.configUrl,e)},c.onload=function(a){c.requestReady?typeof a=="function"?a():avril.event.get("avril.mvc.config.onload")(a):avril.event.get("avril.mvc.config.onload")(a)},c.onload(function(a){var b=avril.tools.cache("version");b!=a.version&&(avril.tools.cache("version",a.version),avril.mvc.config.onVersionChange([b,a.version])),avril.release=a.release}),c.ensure=function(a,b){var d=b.split(",");d.each(function(b){if(typeof a[b]=="function"){var d=a[b];function e(c){return a[b]=d,d.apply(a,c)}a[b]=function(){var a=arguments;if(c.requestReady)return e(a);c.onload(function(){e(a)})}}})},c.onVersionChange=avril.event.get("avril.mvc.config.onVersionChange"),avril.namespace("avril.mvc.models");var d=avril.mvc.models,e=avril.mvc,f=function(){var a={_models:{},model:function(b,c){return b?(a._models[b]?arguments.length==2&&a._models[b](c):(arguments.length==1&&(a._models[b]=ko.observable()),arguments.length==2&&(a._models[b]=ko.observable(c))),a._models[b]):undefined}};return a},g=d.pools=f();d.getPool=f,e.config.onload(function(){avril.object(c.meta).keys().each(function(a){g.model("meta."+a,c.meta[a])})}),avril.namespace("avril.mvc.request");var h=avril.mvc.request,c=avril.mvc.config,i="template-";c.onVersionChange(function(a,b){avril.tools.cache.delByPre(i+a)}),h.getTemplateUrl=function(a,b){c.onload(function(){var c=avril.request(avril.mvc.config.templateUrl);c.param("path",a),b(c.getUrl())})},h.getViewTemplate=function(b,d){d=d||function(){};var e={data:null,template:undefined,templateOk:!1},f=b.split("?")[0],g=i+c.version+"-"+(f.split("/").join("-")||"home"),j=a("#"+g),k=avril.tools.cache(g),l=function(b,c){h.getTemplateUrl(b,function(b){a.ajax({url:b,success:function(a){avril.tools.cache(g,a),c()},error:function(a){c(a)}})})},m=function(){j=a("#"+g),k=avril.tools.cache(g);if(k){if(j.length==0){var b="script";a("<"+b+' type="text/template"/>').attr("id",g).hide().html(k).appendTo("body")}e.template=g,e.templateOk=!0}d(e)};k&&c.release===!0?m():l(f,m)},h.getViewData=function(b,c){var d={url:b};a.ajax({url:b,data:{_backbone:!0},success:function(a){d.data=a,c(d)},error:function(a){d.err=a,d.data=null,c(d)}})},avril.namespace("avril.mvc.routes");var j=avril.mvc.routes,e=avril.mvc,k=j.mvcRoute=Backbone.Router.extend({routes:{"*normalPath":"normalPath"},normalPath:function(b){var c=function(){e.request.getViewTemplate("404",function(a){e.models.pools.model("pageModel")(a)},!1)};d.pools.model("currentRoute")(null),e.request.getViewTemplate(b,function(b){b.templateOk?e.request.getViewData(Backbone.history.getHash(),function(c){var d=a.extend({},b,c);e.models.pools.model("pageModel")(d)}):c()})}}),l=j.addRoute=function(b,c,f,g,h){c.indexOf("?")<0&&l(b,c+"?*query",f,g,h);var i,k;return h&&typeof h=="string"&&(k=h,i=!0),arguments.length<5&&(i=!0),g=g||function(){},n.route(c,b,function(h){var j=arguments;d.pools.model("currentRoute")({name:b,route:c,viewPath:f}),e.request.getViewTemplate(f,function(b){i?e.request.getViewData(k||Backbone.history.getHash(),function(c){var d=a.extend({},b,c);e.models.pools.model("pageModel")(d),g.apply(e.models.pools,j)}):(e.models.pools.model("pageModel")(b),g.apply(e.models.pools,j))})}),j},m=j.addStaticRoute=function(a,b,c,d){return l(a,b,c,d,!1)},n=j.mvcRoute=new j.mvcRoute;j.onHashChange=avril.event.get("avril.mvc.routes.onhashchange",j),Backbone.history.bind("all",function(){j.onHashChange([])}),a(function(){Backbone.history.start(),ko.applyBindings(avril.mvc.models.pools,document.body)})})(jQuery)